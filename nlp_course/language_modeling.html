<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>语言模型</title>
    <meta name="description" content="Language models (from n-gram to neural) and generation strategies.">

    <link rel="stylesheet" href="../css/main.css">
    <link rel="canonical" href="http://lena-voita.github.io/nlp_course/language_modeling.html">

    <!-- diff from head.html begin -->
    <link rel="mask-icon" href="../resources/lectures/ico/course_logo.png">
    <link rel="alternate icon" class="js-site-favicon" type="image/png"
        href="../resources/lectures/ico/course_logo.png">
    <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="../resources/lectures/ico/course_logo.png">
    <!-- diff from head.html end -->


</head>


<body>

    <header class="site-header">

        <div class="wrapper">

            <div id="title-image" style="display:inline">
                <img class="site-img" src="../img/ico/logo.jpeg" />
            </div>

            <div id="title-texts" style="display:inline">
                <a class="site-title" href="https://github.com/MLNLP-World" target="_blank">MLNLP</a>
            </div>

            <nav class="site-nav">
                <a href="#" class="menu-icon">
                    <svg viewBox="0 0 18 15">
                        <path fill="#424242"
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" />
                        <path fill="#424242"
                            d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" />
                        <path fill="#424242"
                            d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" />
                    </svg>
                </a>

                <div class="trigger">
                    <a class="page-link" href="https://lena-voita.github.io/" target="_blank">原作者：Lena Voita</a>
                    <a class="page-link" href="https://lena-voita.github.io/nlp_course/language_modeling.html"
                        target="_blank">原始英文版本</a>
                    <a class="page-link" href="../about.html" target="_blank">关于我们</a>
                    <a class="page-link" href="https://github.com/MLNLP-World/NLP-Course-Chinese" target="_blank">
                        <img height="18" src="../img/ico/github.png" style="vertical-align:middle;" />Github
                    </a>

                </div>
            </nav>

        </div>

    </header>



    <!-- the next two lines are inserted once per page even if there are several shtukovinas,
     the rest is one-per-shtukovina; read more: https://flickity.metafizzy.co/options.html -->
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css" media="screen">
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>

    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        .demo_sidebar {
            margin: 0;
            padding: 0;
            background-color: white;

            position: relative;
            height: auto;
            width: 290px;
        }

        .demo_sidebar_text {
            font-size: 18px;
        }

        .demo_sidebar_comment {
            font-size: 15px;
            margin-left: 10px;
            font-family: "Comic Neue", "Arial";

        }


        .demo_sidebar a {
            display: block;
            color: black;
            padding: 8px;
            text-decoration: none;

        }

        .demo_sidebar a li {
            margin-left: 5px;
            padding: 0px;
        }


        .demo_sidebar a:hover {
            box-shadow: 0 3px 6px #6e8f27, 0 1px 1px #6e8f27;
        }

        .demo_sidebar a:hover:not(.active) {
            background-color: #f3f3f3;
        }

        .demo_sidebar .main_components {
            background-color: #f3f3f3;
        }

        .demo_sidebar .extra_components {
            background-color: #eaeaea;
        }


        #demo_sidebar_research_thinking:hover {
            box-shadow: 0 3px 6px #a68305, 0 1px 1px #a68305;

        }


        #demo_sidebar_related_papers:hover {
            box-shadow: 0 3px 6px #8a4972, 0 1px 1px #8a4972;
        }


        #demo_sidebar_fun:hover {
            box-shadow: 0 3px 6px #377b94, 0 1px 1px #377b94;
        }
    </style>


    <style>
        @import url('https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap');
        @import url("https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap");
        @import url("https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap");


        #main_page_content {
            margin-left: 300px;
            padding: 30px;
            padding-left: 70px;
            text-align: justify;
        }

        .sidebar {
            margin: 0;
            padding: 0;
            width: 270px;
            background-color: #fafafa;
            position: fixed;
            height: 100%;
            overflow: auto;
            z-index: 1;
        }

        .sidebar a,
        .dropdown-btn {
            display: block;
            color: black;
            padding: 8px;
            text-decoration: none;
            border-right: 5px solid #b7db67;
        }


        .sidebar a li {
            margin-left: 10px;
            padding: 0px;
        }

        .dropdown-container {
            display: none;
            background-color: #f4f4f4;
        }

        .active_caret .fa-caret-down {
            color: #b7db67;
            font-size: 30px;
        }

        .fa-caret-down {
            float: right;
            padding-right: 8px;
        }

        .sidebar a.active {
            background-color: #e3e3e3;
            color: black;
        }

        .sidebar a:hover {
            box-shadow: 0 3px 6px #6e8f27, 0 1px 1px #6e8f27;
        }

        .sidebar a:hover:not(.active) {
            background-color: #f3f3f3;
        }

        .sidebar .extra_components {
            background-color: #eaeaea;
        }

        #sidebar_analysis {
            padding: 10px;
        }

        #sidebar_research_thinking {
            padding: 10px;
            border-right: 5px solid #fad400;
        }

        #sidebar_research_thinking:hover {
            box-shadow: 0 3px 6px #a68305, 0 1px 1px #a68305;

        }


        #sidebar_related_papers {
            padding: 10px;
            border-right: 5px solid #d192ba;
        }

        #sidebar_related_papers:hover {
            box-shadow: 0 3px 6px #8a4972, 0 1px 1px #8a4972;
        }


        #sidebar_fun {
            padding: 10px;
            border-right: 5px solid #6fb7d1;
        }

        #sidebar_fun:hover {
            box-shadow: 0 3px 6px #377b94, 0 1px 1px #377b94;
        }


        .sidebar_ico {
            float: right;
            height: 20;
        }

        div.content {
            margin-left: 200px;
            padding: 1px 16px;
            height: 1000px;
        }

        #sidebar_small {
            width: 60px;
        }


        @media screen and (max-width: 1000px) {
            .sidebar {
                width: 200px;
            }

            #main_page_content {
                margin-left: 200px;
                padding-left: 50px;
            }

            #for_you_in_sidebar {
                display: none;
            }

        }


        @media screen and (max-width: 800px) {

            div.content {
                margin-left: 0;
            }

            #main_page_content {
                margin-left: 80px;
                padding: 15px;
            }

            #demo_sidebar {}
        }


        .softmax_tau_bokeh {
            font-size: 16px;
        }


        .card_with_ico {
            position: relative;
            padding: 10px;
            margin: 10px;
        }

        .card_with_ico p {
            padding: 10px;
        }

        .card_with_ico ul {
            padding: 10px;
        }

        .card_with_ico .text_box_green {
            border: 1px solid #d8e8b5;
            border-radius: 5px;
            margin-left: 30px;
        }

        .card_with_ico .text_box_pink {
            border: 1px solid #dec8d6;
            border-radius: 5px;
            margin-left: 30px;
        }

        .card_with_ico .text_box_yellow {
            border: 1px solid #f0e4a5;
            border-radius: 5px;
            margin-left: 30px;
        }

        .card_with_ico .ico {
            float: left;
            width: 25px;
        }


        .text_box_green {
            border: 1px solid #d8e8b5;
            border-radius: 5px;
            display: table;
            margin-left: 20px;
        }

        .text_box_green p {
            padding: 10px;
            padding-bottom: 0px;
        }


        .green_left_thought {
            border-left: 5px solid #b7db67;
            margin: 10px;
            margin-left: 20px;
            padding: 0px;
            background-color: #fafcf5;
        }

        .green_left_thought p {

            margin-left: 10px;
            padding: 5px;
        }


        .box_green_left {
            border-left: 2px solid #79a123;
            margin-left: 10px;
            padding: 10px;
        }

        .box_green_right {
            border-right: 2px solid #79a123;
            margin-right: 10px;
            padding: 10px;
        }

        .box_violet_right {
            border-right: 2px solid #67468f;
            margin-right: 10px;
            padding: 10px;
        }

        .box_pink_left {
            border-left: 2px solid #7a3160;
            margin-left: 5px;
            padding: 10px;
        }

        .box_yellow_left {
            border-left: 2px solid #d6b000;
            margin-left: 5px;
            padding: 10px;
        }

        .box_blue_left {
            border-left: 2px solid #0278a1;
            margin-left: 5px;
            padding: 10px;
        }

        .paper_title {
            text-align: center;
            padding: 5px;
            padding-top: 0px;
            font-size: 16px;

        }

        .paper_authors {
            font-size: 14px;
            text-align: center;
            margin-bottom: 10px;
        }

        p {
            text-align: justify;
        }


        .greenCard {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 1px;
            margin: 10px 5px;
            padding: 3px;
            display: grid;
            grid-template-rows: auto auto;
        }

        #thumbnail_green {
            box-shadow: 0 2px 4px #6e8f27, 0 1px 1px #6e8f27;
        }

        #thumbnail_green:hover {
            box-shadow: 0 6px 12px #6e8f27, 0 4px 4px #6e8f27;
        }

        #thumbnail_violet {
            box-shadow: 0 2px 4px #655578, 0 1px 1px #655578;
        }

        #thumbnail_violet:hover {
            box-shadow: 0 6px 12px #655578, 0 4px 4px #655578;
        }

        #thumbnail_paper {
            box-shadow: 0 2px 4px #ab859e, 0 1px 1px #ab859e;
        }

        #thumbnail_paper:hover {
            box-shadow: 0 6px 12px #ab859e, 0 4px 4px #ab859e;
        }


        #thumbnail_blue {
            box-shadow: 0 2px 4px #377b94, 0 1px 1px;
        }

        #thumbnail_blue:hover {
            box-shadow: 0 6px 12px #377b94, 0 4px 4px #377b94;
        }

        .paperCard {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 1px;
            margin: 10px 5px;
            padding: 3px;
            display: grid;
            grid-template-rows: auto auto;
        }

        .paperIntro {
            display: grid;
            grid-template-columns: 70% 30%;
        }

        .showMePaper {
            box-shadow: 0 2px 4px #a68305, 0 2px 1px #a68305;
        }

        .showMePaper:hover {
            box-shadow: 0 3px 6px #ab859e, 0 4px 4px #ab859e;
        }


        .cardContent {
            padding: 10px;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .conf_name {
            float: right;
            font-family: sans-serif;
            font-size: 13px;
            margin-bottom: 0px;
            background-color: #f7edf4;
            border: 1px solid #d1a1c3;
            border-radius: 1px;
            padding: 0px 4px 0px 4px;
        }


        .paper_circle {
            height: 10px;
            width: 10px;
            background-color: #cf99be;
            border: 1px solid #8c2b6e;
            border-radius: 50%;
        }

        .research_circle {
            height: 10px;
            width: 10px;
            background-color: #ffda00;
            border: 1px solid #998300;
            border-radius: 50%;
        }

        .fun_circle {
            height: 10px;
            width: 10px;
            background-color: #68c7e8;
            border: 1px solid #0278a1;
            border-radius: 50%;
        }

        .green_circle {
            height: 10px;
            width: 10px;
            background-color: #b7db67;
            border: 1px solid #598005;
            border-radius: 50%;
        }

        .violet_circle {
            height: 10px;
            width: 10px;
            background-color: #b59fcf;
            border: 1px solid #67468f;
            border-radius: 50%;
        }

        .data_text {
            font-family: "Comic Neue", "Arial";
        }


        .researchCard {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 1px;
            margin: 10px 5px;
            padding: 3px;
            display: grid;
            grid-template-rows: auto auto;
        }

        .researchIntro {
            display: grid;
            grid-template-columns: 70% 30%;
        }

        #thumbnail_research {
            box-shadow: 0 2px 4px #a68305, 0 1px 1px #a68305;
        }

        #thumbnail_research:hover {
            box-shadow: 0 6px 12px #a68305, 0 4px 4px #a68305;
        }

        .research_title {
            text-align: center;
            padding: 5px;
            font-size: 18px;
            font-family: "Comic Neue", "Arial";
            background-color: #fafaf5;


        }

        .research_tag {
            float: right;
            font-family: sans-serif;
            font-size: 13px;
            margin-bottom: 0px;
            background-color: #f5f0d5;
            border: 1px solid #fad400;
            border-radius: 1px;
            padding: 0px 4px 0px 4px;
        }

        .research_question {
            font-weight: bold;
            font-size: 18px;
            background-color: #fff4b3;
            margin-right: 15px;
            padding-left: 5px;
            padding-right: 5px;
        }

        .research_summary {
            padding: 5px;
            font-size: 18px;
            font-family: "Comic Neue", "Arial";
            background-color: #fafaf5;
            margin-left: 10px;
        }


        .text_table td,
        .text_table th {
            text-align: center;
            padding-left: 10px;
            padding-right: 10px;
            padding-top: 2px;
            padding-bottom: 2px;
        }
    </style>

    <!--##################################################-->

    <div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar_components">
                <a href="javascript:void(0)" id="close_sidebar_btn" onclick="closeNav()"
                    style="text-align:center;font-size:30px;padding:0px;">⇤</a>
                <a class="active" href="../index.html" style="font-weight: bold;">
                    <img height="18" class='sidebar_ico' src="../resources/lectures/ico/course_logo.png"
                        style="margin-right: 8px;margin-left: 8px;margin-top: 4px;" />
                    NLP Course <font color="#92bf32" id="for_you_in_sidebar">| 专属定制</font></a>
                <a href="#main_content" style="font-weight: bold;">语言模型</a>
                <a href="#intro">什么是语言模型？</a>

                <div class="dropdown-scope">
                    <a class="dropdown-btn" id="dropdown_general">通用框架
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="dropdown-container">
                        <a href="#text_probability"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>文本概率</a>
                        <a href="#generation"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>使用语言模型生成文本</a>
                    </div>
                </div>

                <div class="dropdown-scope">
                    <a class="dropdown-btn" id="dropdown_ngram">N元语法语言模型
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="dropdown-container">
                        <a href="#n_gram"><span style="margin-right:15px;font-size:14px;">&#8226;</span>想法</a>
                        <a href="#markov_property"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>马尔科夫性</a>
                        <a href="#n_gram_smoothing"><span style="margin-right:15px;font-size:14px;">&#8226;</span>平滑</a>
                        <a href="#n_gram_generation"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>生成及示例</a>
                    </div>
                </div>

                <div class="dropdown-scope">
                    <a class="dropdown-btn" id="dropdown_neural">神经网络语言模型
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="dropdown-container">
                        <a href="#neural_lms"> <span style="margin-right:15px;font-size:14px;">&#8226;</span>想法</a>
                        <a href="#neural_high_level_pipeline"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>高层流水线</a>
                        <a href="#neural_lms_training"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>训练</a>
                        <a href="#neural_lms_models_rnn"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>模型：循环</a>
                        <a href="#neural_lms_models_cnn"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>模型：卷积</a>
                    </div>
                </div>

                <div class="dropdown-scope">
                    <a class="dropdown-btn" id="dropdown_neural">生成策略
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="dropdown-container">
                        <a href="#generation_strategies"> <span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>连贯性和多样性</a>
                        <a href="#generation_strategies_sampling"> <span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>采样</a>
                        <a href="#generation_strategies_temperature"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>温度采样</a>
                        <a href="#generation_strategies_top_k"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>Top-K采样</a>
                        <a href="#generation_strategies_top_p"><span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>Top-p(核)采样</a>
                    </div>
                </div>


                <a href="#evaluation">评价</a>

                <div class="dropdown-scope">
                    <a class="dropdown-btn">实用技巧
                        <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="dropdown-container">
                        <a href="#weight_tying_trick"> <span
                                style="margin-right:15px;font-size:14px;">&#8226;</span>权重绑定</a>
                    </div>
                </div>

                <a href="#analysis_interpretability" id="sidebar_analysis">分析与解释
                    <img height="25" src="../resources/lectures/ico/analysis_empty.png" class="sidebar_ico" /></a>
                <div class="extra_components">
                    <a href="#research_thinking" id="sidebar_research_thinking">研究思考
                        <img height="30" src="../resources/lectures/ico/bulb_empty.png" class="sidebar_ico" /></a>
                    <!--<hr color="#b7db67">-->

                    <a href="#related_papers" id="sidebar_related_papers">相关论文
                        <img height="22" src="../resources/lectures/ico/book_empty.png" class="sidebar_ico" /></a>
                    <!--<hr color="#b7db67">-->

                    <a href="#have_fun" id="sidebar_fun">Have Fun! <img height="30"
                            src="../resources/lectures/ico/fun_empty.png" class="sidebar_ico" /></a>
                </div>
            </div>
        </div>


        <div class="sidebar" id="sidebar_small">

            <a class="active" onclick="openNav()" style="text-align:center;">☰</a>
            <a class="active" href="../nlp_course.html" style="font-weight: bold;">
                <img height="20" src="../resources/lectures/ico/course_logo.png"
                    style="margin-right: 8px;margin-left: 8px;" /></a>
            <a href="#main_page_content" style="text-align:center; font-size:20px;color:#7ca81e"> <i
                    class="fa fa-home"></i></a>

            <a href="#analysis_interpretability" id="sidebar_analysis"> <img height="25"
                    src="../resources/lectures/ico/analysis_empty.png" /></a>
            <div class="extra_components">
                <a href="#research_thinking" id="sidebar_research_thinking"><img height="30"
                        src="../resources/lectures/ico/bulb_empty.png" /></a>
                <!--<hr color="#b7db67">-->

                <a href="#related_papers" id="sidebar_related_papers"><img height="22"
                        src="../resources/lectures/ico/book_empty.png" /></a>
                <!--<hr color="#b7db67">-->

                <a href="#have_fun" id="sidebar_fun"><img height="30"
                        src="../resources/lectures/ico/fun_empty.png" /></a>
            </div>
        </div>


        <script>
            function openNav() {
                document.getElementById("sidebar").style.display = "block";
                document.getElementById("sidebar_small").style.display = "none";
                document.getElementById("close_sidebar_btn").style.display = "block";
            }

            function closeNav() {
                document.getElementById("sidebar").style.display = "none";
                document.getElementById("sidebar_small").style.display = "block";
                document.getElementById("close_sidebar_btn").style.display = "none";
            }

        </script>


        <script>
            function onResize() {
                if (window.innerWidth >= 800) {
                    document.getElementById("sidebar").style.display = "block";
                    document.getElementById("sidebar_small").style.display = "none";
                    document.getElementById("close_sidebar_btn").style.display = "none";
                } else {
                    document.getElementById("sidebar").style.display = "none";
                    document.getElementById("sidebar_small").style.display = "block";

                }
            }

            window.onresize = onResize;
            onResize();
        </script>

        <script>
            /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
            var dropdown = document.getElementsByClassName("dropdown-btn");
            var i;

            for (i = 0; i < dropdown.length; i++) {
                dropdown[i].addEventListener("click", function (event) {
                    this.classList.toggle("active_caret");
                    var dropdownButton = event.target || event.srcElement;
                    while (dropdownButton.className != "dropdown-scope")
                        dropdownButton = dropdownButton.parentElement;
                    var dropdownContent = dropdownButton.getElementsByClassName("dropdown-container")[0];

                    if (dropdownContent.style.display === "block") {
                        dropdownContent.style.display = "none";
                    } else {
                        dropdownContent.style.display = "block";
                    }
                });
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.1.0/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js"></script>
        <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

        <style>
            :root {}

            .lm_window {
                width: 100%;
                border: 1px solid #ccc;
                border-radius: 1px;
                margin: 10px 5px;
                padding: 3px;
                background-color: white;
                text-align: center;
            }

            #lm_window {
                box-shadow: 0 2px 4px #377b94, 0 1px 1px;
            }

            #lm_window:hover {
                box-shadow: 0 6px 12px #377b94, 0 4px 4px #377b94;
            }

            .prompt_text {
                font-size: 24px;
                font-family: "Comic Neue", "Arial";
                margin-top: 10px;
                margin-bottom: 10px;
                font-weight: bold;
                text-align: center;
                background-color: #ebf6fa;
            }

            .comment_text {
                font-size: 16px;
                font-family: "Gill Sans", sans-serif;
                font-style: italic;
                text-align: center;
            }

            .rect_button {
                width: 25%;
                background-color: #fafafa;
                font-size: 20px;
                font-family: "Comic Neue", "Arial";
                font-weight: bold;
                color: black;
                margin-right: 20px;
                margin-left: 20px;
                margin-top: 10px;
                margin-bottom: 10px;
                border: 0px solid black;
                border-radius: 12px;
                padding: 20px;
                padding-top: 0px;
                padding-bottom: 0px;
                text-decoration: none;
                display: inline-block;
                text-align: center;
                box-shadow: 0px 2px 3px #377b94, 0 1px 1px #377b94;
            }

            .rect_button:hover {
                box-shadow: 0 3px 6px #377b94, 0 2px 2px #377b94;
            }

            .button_text {
                margin-top: 3px;
                margin-bottom: 3px;
            }

            .prompt_and_button {
                display: grid;
                grid-template-columns: auto 30px;
            }

            .next_button {
                width: 0;
                height: 0;
                border-top: 30px solid transparent;
                border-left: 45px solid #1b6f8c;
                border-bottom: 30px solid transparent;
            }

            .next_text {
                color: #1b6f8c;
                font-style: italic;
                font-weight: 600;
                font-family: "Comic Neue", "Arial";
                margin: 0 auto;
            }

            .axis path,
            .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
                /* Round any decimal pixels so it'll render nicely */
            }
        </style>


        <div class="wrapper" id="main_page_content">
            <div class="header">
                <h1>语言模型（Language Modeling） <a
                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Have%20Fun!-,Language%20Modeling,-What%20does%20it"
                        style="font-size:9px;" target="_blank">(英文原文)</a></h1>
            </div>

            <div class="main_content" id="main_content">

                <p class="data_text">
                    <font color="black">
                        译者：<a href="https://xiaoyuanyi.github.io/" target="_blank">矣晓沅</a> 校对：<a
                            href="https://cartus.github.io/" target=" _blank">郭志江</a>
                    </font>
                </p>


                <div id="intro">

                    <h2>所谓“对某种事物建模”的含义？ <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=What%20does%20it%20mean%20to%20%22model%20something%22%3F"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>
                    <p>举个例子，想象你有了一个物理世界的模型，那么你期望这个模型能做什么事呢？对一个好模型来说，给定某种“上下文”的描述，那么它也许能预测接下来会发生什么，也就是事物的当前状态，就像下面这样：</p>

                    <p class="data_text" style="margin-left:30px;">
                        我们有用某种材料做成的符合某种尺寸的固定数量的立方体搭成的一个塔。如果我们用这个力从某个点向某个方向推动底部立方体。会发生什么？</p>

                    <p>
                        一个好的模型能够模拟真实世界的行为:它能“理解”哪些事件更符合世界，即哪些事件<b>更有可能</b>发生。

                    </p>

                    <h2>对语言又是怎么样呢？ <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=What%20about%20language%3F"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                    <p>
                        对于语言来说，直观理解是完全一样的！不同之处在于对<b>事件</b>的定义。在语言中，<b>事件</b>
                        是指一个语言单位（文本、句子、token、符号），语言模型的目标是估计这些事件的概率。

                    </p>

                    <div class="green_left_thought" style="font-size:18px;">
                        <p class="data_text">语言模型(Language Models, LMs)估计不同的语言单位的概率，如符号，token和token序列。</p>
                    </div>


                    <p>但这到底有什么用呢？</p>

                    <div class="carousel"
                        data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true }'
                        style="width:50%; margin-bottom:30px; margin-left:10px; float:right;">
                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <img width=70% src="../resources/lectures/lang_models/examples/suggest-min.png" />
                            </center>
                        </div>
                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <img width=70%
                                    src="../resources/lectures/lang_models/examples/autocompletion-min.png" />
                            </center>
                        </div>
                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <img width=70% src="../resources/lectures/lang_models/examples/misspell_mt-min.png" />
                            </center>
                        </div>
                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <img width=70% src="../resources/lectures/lang_models/examples/misspell-min.png" />
                            </center>
                        </div>
                    </div>
                    <h2>我们每天都和语言模型打交道! <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=We%20deal%20with%20LMs%20every%20day!"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                    <p>
                        我们每天都会看到语言模型在起作用——让我们看一些例子。通常来说大型商业服务中的模型比我们今天讨论的更复杂一些，但想法是一样的：如果我们能估计单词、句子等的概率，那么我们就能以各种方式，有时甚至出乎意料的方式，来使用它们。
                    </p>


                    <h2>对人类来说容易的事情，对机器来说很难 <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=What%20is%20easy%20for%20humans%2C%20can%20be%20very%20hard%20for%20machines"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                    <center>
                        <img src="../resources/lectures/lang_models/examples/morphosyntax-min.png"
                            style="max-width:80%; margin-bottom:15px;" />
                        <div style="font-size:14px; margin-left: 30px; margin-right: 30px;" class="data_text">
                            <font color="#888">
                                <u>编者按</u>:
                                这一<span style="font-weight:bold;">形态语法</span>的例子来自于Alex Lascarides和Sharon
                                Goldwater的幻灯片，爱丁堡大学的自然语言处理基础课程。
                            </font>
                        </div>
                    </center>
                    <br>

                    <p>
                        对于自然语言，我们人类早已具备对“概率”的某种感觉。例如，当我们交谈时，通常我们都能很好地理解对方（至少能理解我们说出的话语）。对那些发音很相似的语义选项的歧义，我们能够消除它们的歧义，而我们甚至都没有主动意识到这一点！
                    </p>


                    <p>但是机器应该如何理解这一点呢？机器需要一个语言模型来估计句子的概率。一个好的语言模型应该能为正确的语义选项分配更大的概率。

                    </p>

                </div>


                <div id="general">
                    <h1>通用框架 <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=a%20correct%20option.-,General%20Framework,-Text%20Probability"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h1>

                    <h2 id="text_probability">文本概率 <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=General%20Framework-,Text%20Probability,-Our%20goal%20is"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>
                    <p>我们的目标是估计文本片段的概率；为了简单起见，我们假设处理的是句子。我们希望这些概率能反映一种语言的知识。具体来说，根据我们的语言模型，我们希望“更有可能”出现在一种语言中的句子能有更大的概率。

                    </p>

                    <h3><u>一个句子有多大的可能性出现在一种语言中？</u> <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=How%20likely%20is%20a%20sentence%20to%20appear%20in%20a%20language%3F"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h3>
                    <center>
                        <img src="../resources/lectures/lang_models/general/probability_simple_vs_sentence-min.png"
                            style="max-width:100%; margin-bottom:10px;" />
                    </center>

                    <!--<img src="../resources/lectures/lang_models/general/balls-min.png"
         style="float:right; margin-left: 25px; max-width:20%"/>-->

                    <p>
                        <!--How can we estimate the probability of a sentence?-->
                        让我们用简单的概率论知识来帮助理解。想象我们有一个装有不同颜色的球的篮子。从这个篮子里选出一个特定颜色（比如绿色）的球的概率就是绿色球出现在篮子里的频率。

                    </p>

                    <!--<img src="../resources/lectures/lang_models/general/frequency_language-min.png"
         style="float:right; margin-left: 25px; max-width:35%"/>-->

                    <p>
                        如果也这样来处理句子呢？因为无法得到一个包含自然语言中所有句子的文本语料库，所以很多句子不会出现在我们的语料库中。虽然在这些句子中，有些明显比其他句子更有可能出现，但按上述方法处理后，这些句子的概率都为零，也就是说，对模型来说看起来是一样糟糕。这意味着，上面的方法不好，我们必须进行一些更明智的处理。

                    </p>

                    <h3><u>句子概率：分解成更小的部分</u> <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Sentence%20Probability%3A%20Decompose%20Into%20Smaller%20Parts"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h3>

                    <p>如果我们把句子当作最小单位来处理，我们则无法可靠地估计句子的概率。相反，我们可以将一个句子的概率分解为更小部分的概率。
                    </p>

                    <p>
                        例如，我们以<span
                            class="data_text"><strong>“我看见一只猫在垫子上”</strong></span>这句话为例，想象我们逐词地读它。在每一步中，我们都会估计到目前为止看到的所有token的概率。因为我们不进行任何无效的计算（绝不！），所以，一旦一个新词出现，我们不用抛弃之前已经算过的概率：我们可以通过更新它来解释一个新词，请看图示。

                    </p>

                    <center>
                        <img src="../resources/lectures/lang_models/general/icons8-kitty-100.png"
                            style="height:40px;float:right;margin-top:30px;" />
                        <img src="../resources/lectures/lang_models/general/i_saw_a_cat_prob.gif"
                            style="max-width:80%; margin-bottom:10px;" />
                    </center>


                    <p>
                        形式化地，定义\(y_1, y_2, \dots, y_n\)为一个句子中的tokens, \(P(y_1, y_2, \dots,
                        y_n)\)为以给定的顺序看见所有这些token的概率。使用概率的乘法法则(即链式法则)，我们得到：
                        \[P(y_1, y_2, \dots, y_n)=P(y_1)\cdot P(y_2|y_1)\cdot P(y_3|y_1, y_2)\cdot\dots\cdot P(y_n|y_1,
                        \dots, y_{n-1})=
                        \prod \limits_{t=1}^n P(y_t|y_{\mbox{<}t}).\] 我们将文本的概率分解为了给定前序上文的每个token的条件概率。 </p>


                            <h3><u>我们得到了：从左向右的语言模型</u> <a
                                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=We%20got%3A%20Left%2Dto%2DRight%20Language%20Models"
                                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>
                            <img src="../resources/lectures/lang_models/general/need_to_define-min.png"
                                style="float:right; margin-left: 25px; max-width:45%" />
                            <p>
                                我们得到的是标准的从左到右语言建模框架。这个框架非常通用：N元语法和神经语言模型的唯一不同之处在于它们计算条件概率\(P(y_t|y_1, \dots,
                                y_{t-1})\)的方式不同.

                            </p>

                            <p class="data_text">
                                <font color="#888">
                                    <u>编者按</u>:
                                    在后续的课程中我们将看到其他类型的语言模型：例如，掩码语言模型或者是以不同方式分解联合概率的模型（例如，任意顺序的token，而不是固定的从左到右的顺序）。
                                </font>
                            </p>

                            <p>稍后我们将讨论N元语法和神经模型的细节。现在，我们讨论如何使用语言模型生成文本。

                            </p>


                            <br>

                            <h2 id="generation">使用语言模型生成文本 <a
                                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=a%20language%20model.-,Generate%20a%20Text%20Using%20a%20Language%20Model,-Once%20we%20have"
                                    style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                            <p>一旦我们有一个语言模型，我们就可以用它来生成文本。我们一次生成一个token：根据前序的上下文预测下一个token的概率分布，并从这个分布中采样。

                            </p>

                            <!--<img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;"/>
    <div class="box_green_left">
        <div class="text_box_green" style="margin-bottom:15px;">
            <p class="data_text">
                <u>How to:</u> Look at the illustration of the generation process.</p>
        </div>-->
                            <video width="70%" height="auto" loop autoplay muted style="margin-left: 20px;">
                                <source src="../resources/lectures/lang_models/general/generation_example.mp4"
                                    type="video/mp4">
                            </video>
                            <!--</div>
    <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;"/>-->


                            <p>
                                或者你也可以使用<b>贪心解码</b>：在每个一步中，选择概率最高的token。然而，这通常效果并不好：稍后我将展示真实模型的一些例子。
                            </p>

                            <p>
                                尽管很简单，但这一采样方法在生成中还是很常见的。在<a
                                    href="#generation_strategies">“生成策略”</a>一节中，我们将研究该方法的不同变体以获得具有特定质量的样本；
                                例如，更有“新意”或者更“平凡”。

                            </p>


                </div>


                <br>

                <div id="n_gram">
                    <h1>N元语法(N-gram)语言模型 <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=or%20less%20%22surprising%22.-,N%2Dgram%20Language%20Models,-Let%20us%20recall"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h1>

                    <p>
                        让我们回顾一下，<a href="#general">通用的从左到右语言建模框架</a>将一个token序列的概率分解为给定前序上下文的每个token的条件概率：
                        \[P(y_1, y_2, \dots, y_n)=P(y_1)\cdot P(y_2|y_1)\cdot P(y_3|y_1, y_2)\cdot\dots\cdot P(y_n|y_1,
                        \dots, y_{n-1})=
                        \prod \limits_{t=1}^n P(y_t|y_{\mbox{<}t}).\] 目前唯一不清楚的就是如何计算这些概率。 </p>

                            <div class="green_left_thought">
                                <p class="data_text" style="font-size:18px;"><u>我们需要</u>:
                                    定义如何计算条件概率 \(P(y_t|y_1, \dots, y_{t-1})\).</p>
                            </div>

                            <p>
                                与我们之前在<a href="./word_embeddings.html"
                                    target="_blank">单词嵌入</a>课程中看到的基于计数的方法类似，n元语法语言模型也从文本语料库中计算全局<font face="arial">统计
                                </font>数据。
                            </p>

                            <div class="green_left_thought">
                                <p class="data_text" style="font-size:18px;"><u>如何</u>:
                                    基于文本语料库的全局统计数据进行估计，即<strong>计数</strong>. :

                                </p>
                            </div>

                            <p>
                                也就是说，n元语法的语言模型估计概率\(P(y_t|y_{\mbox{<}t})=P(y_t|y_1, \dots,
                                    y_{t-1})\)的方式几乎和我们之前估计的从篮子选绿球的概率一样。<b>“几乎”</b>一词包含n元语法原模型的关键构成：
                                    <b>马尔可夫特性</b>和<b>平滑</b>。
                            </p>

                            <div id="markov_property">
                                <h2>马尔科夫性 (独立性假设) <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Markov%20Property%20(Independence%20Assumption)"
                                        style="font-size:9px;" target="_blank">(英文原文)</a>
                                </h2>

                                <p>
                                    计算\(P(y_t|y_1, \dots, y_{t-1})\)最直接的方法是
                                    \[P(y_t|y_1, \dots, y_{t-1}) = \frac{N(y_1, \dots, y_{t-1}, y_t)}{N(y_1, \dots,
                                    y_{t-1})},\]
                                    其中\(N(y_1, \dots, y_k)\)是token序列\((y_1, \dots, y_k)\) 出现在文本中的次数。

                                </p>

                                <p>
                                    出于我们之前讨论过的同样原因，这样效果并不会好：许多片段\((y_1,
                                    \dots, y_{t})\)没有在语料库中出现过, 因此会使句子的概率变为零。为了解决这个问题，我们做了一个独立性假设（假设马尔可夫性成立）：

                                </p>
                                <div class="green_left_thought">
                                    <p class="data_text" style="font-size:18px;">
                                        一个单词的概率只取决于前面<strong>固定</strong>数量的单词。

                                    </p>
                                </div>

                                形式化地 ，n元语法模型假设
                                \[P(y_t|y_1, \dots, y_{t-1}) = P(y_t|y_{t-n+1}, \dots, y_{t-1}).\]
                                例如,
                                <ul>
                                    <li>n=3 (三元trigram模型): \(P(y_t|y_1, \dots, y_{t-1}) = P(y_t|y_{t-2}, y_{t-1})\),
                                    </li>
                                    <li>n=2 (二元bigram模型): \(P(y_t|y_1, \dots, y_{t-1}) = P(y_t|y_{t-1})\),</li>
                                    <li>n=1 (一元unigram模型): \(P(y_t|y_1, \dots, y_{t-1}) = P(y_t)\).</li>
                                </ul>

                                <p>下图请看n-gram模型的标准分解是如何变化的。</p>

                                <img width="80%"
                                    src="../resources/lectures/lang_models/ngram/example_cut_3gram-min.png" />

                            </div>

                            <br>


                            <div id="n_gram_smoothing">
                                <h2>平滑化：重新分配概率质量 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Smoothing%3A%20Redistribute%20Probability%20Mass"
                                        style="font-size:9px;" target="_blank">(英文原文)</a>
                                </h2>

                                <p>让我们想象处理一个4元语言模型并考虑下面的例子：


                                </p>
                                <center>
                                    <img width="70%"
                                        src="../resources/lectures/lang_models/ngram/prob_cat_on_a_mat-min.png"
                                        style="margin-bottom: 15px;" />
                                </center>

                                <p>
                                    如果上式的分母或分子都为零呢？这两种情况对模型都不好。为了避免这些（以及其他）问题，通常的做法是用<b>平滑</b>
                                    。平滑是指重新分配概率质量：从已知事件中“窃取”一些质量给那些未出现过的。

                                </p>

                                <p class="data_text">
                                    <font color="#888"><u>编者按</u>:
                                        在这点上，我会忍不住想象一个勇敢的罗宾汉劫富济贫——就像概率质量的平滑一样。不幸的是，我不得不阻止自己这样写，因为老实说，平滑并不是那么明智——这会冒犯罗宾。
                                    </font>
                                </p>


                                <h3><u>避免分母为零</u> <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Avoid%20zeros%20in%20the%20denominator"
                                        style="font-size:9px;" target="_blank">(英文原文)</a></h3>
                                <img width="45%" src="../resources/lectures/lang_models/ngram/denominator_zero-min.png"
                                    style="float:right; margin-left:30px;" />

                                <p>
                                    如果我们的语料库中从未出现过<span class="data_text"><strong>“cat on
                                            a”</strong></span>这个短语，我们将无法计算其概率。因此，如果发生这种情况，我们需要一个“B计划”。
                                </p>
                                <br>

                                <div id="smoothing_stupid_backoff" style="margin-left:40px;">
                                    <img width="35%" src="../resources/lectures/lang_models/ngram/backoff-min.png"
                                        style="float:right; margin-left:30px;" />
                                    <h4><u>回退 (又称愚蠢回退)</u> <a
                                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Backoff%20(aka%20Stupid%20Backoff)"
                                            style="font-size:9px;" target="_blank">(英文原文)</a></h4>
                                    <p>
                                        其中一个解决方案是对我们不太了解的上下文使用较少的上下文，称之为 <b>回退：</b>
                                    <ul>
                                        <li>如果可行，则使用三元语法;
                                        </li>
                                        <li>如果不行，则用二元语法;</li>
                                        <li>二元还不行，则使用一元.
                                        </li>
                                    </ul>
                                    这种做法非常愚蠢(一如其名称)，但是效果不错。
                    </p>
                </div>
                <br>

                <div id="smoothing_interpolation" style="margin-left:40px;">
                    <h4><u>更聪明的做法：线性插值
                        </u> <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=More%20clever%3A%20Linear%20interpolation"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h4>
                    <p>

                        更聪明的解决方法是对一元、二元、三元等等进行混合。为此，我们需要非负的权重\(\lambda_0, \lambda_1, \dots, \lambda_{n-1}\)满足
                        \(\sum\limits_{i}\lambda_i=1\) . 然后更新后概率为：
                        <center>
                            <img width="45%" src="../resources/lectures/lang_models/ngram/interpolation-min.png"
                                style="margin-bottom:15px;" />
                        </center>
                        系数\(\lambda_i\)可以通过开发集上的交叉验证来选取。一旦你知道如何评估语言模型，就可以这样做了：请参阅<a href="#evaluation">评测</a> 部分。

                    </p>
                </div>


                <h3><u>避免分子为零</u> <a
                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Avoid%20zeros%20in%20the%20numerator"
                        style="font-size:9px;" target="_blank">(英文原文)</a></h3>
                <img width="50%" src="../resources/lectures/lang_models/ngram/numerator_zero-min.png"
                    style="float:right; margin-left:30px;" />

                <p>
                    如果短语<span class="data_text"><strong>“cat on a
                            mat”</strong></span>从未出现在我们的语料库中，那么整个句子的概率将为零——但这并不意味着这个句子是不可能出现的！为了避免这种情况，我们依然需要一个“B计划”。

                </p>
                <br>

                <div id="smoothing_laplace" style="margin-left:40px;">
                    <h4><u>拉普拉斯平滑 (也称加一平滑)</u> <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Laplace%20smoothing%20(aka%20add%2Done%20smoothing)"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h4>
                    <p>
                        避免这种情况的最简单方法就是<b>假装</b> 我们<b>至少见过一次</b>
                        所有的n元语法：只需在所有计数中加1！或者，可以添加一个小\(\delta\)，而不是1：
                    </p>
                    <center>
                        <img width="45%" src="../resources/lectures/lang_models/ngram/laplace-min.png" />
                    </center>
                </div>


                <br>

                <h3><u>更明智的平滑</u> <a
                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=More%20Clever%20Smoothings"
                        style="font-size:9px;" target="_blank">(英文原文)</a></h3>

                <!--<div class="card_with_ico">
        <img class="ico" width="40" src="../resources/lectures/ico/book_empty.png"/>
        <div class="text_box_pink">
            <p class="data_text">

                <strong>Good-Turing Smoothing.</strong><br>
                    <a href="papers_smoothings">More details are here.</a>
            <font color="red">link to Kneser-Ney and Good Turing</font>
            </p>
        </div>
    </div>
-->
                <div class="card_with_ico">
                    <img class="ico" width="40" src="../resources/lectures/ico/book_empty.png" />
                    <div class="text_box_pink">
                        <p class="data_text">
                            <strong>Kneser-Ney 平滑.</strong><br>
                            n元语法的语言模型最常用的平滑是Kneser-Ney平滑：它是回退的一个更明智的变体。<a href="#papers_smoothings">更多细节</a>在这里。
                        </p>
                    </div>
                </div>


            </div>


            <div id="n_gram_generation">
                <h2>生成(以及示例) <a
                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Generation%20(and%20Examples)"
                        style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                <p>
                    n-gram语言模型的生成过程与一般模型相同：给定当前上下文（历史），生成下一个token（在词表中的所有token上）的概率分布，采样一个token，将该token添加到序列中，然后再次重复上述所有步骤。n-gram模型特有的唯一部分是我们计算概率的方式。请看如下示例。
                </p>

                <video width="70%" height="auto" loop autoplay muted style="margin-left: 20px;">
                    <source src="../resources/lectures/lang_models/general/generation_ngram.mp4" type="video/mp4">
                </video>

                <h3 id="ngram_sample_examples"><u>生成的文本的实例</u> <a
                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Examples%20of%20generated%20text"
                        style="font-size:9px;" target="_blank">(英文原文)</a></h3>

                <p>为了给大家展示一些例子，我们在250万个英文句子上训练了一个3元的模型。
                </p>

                <p class="data_text" style="font-size:14px">
                    <font color="#888"><u>数据集细节。</u>
                        数据是WMT英俄翻译数据的英文部分，由250万句子对组成（一对英语和俄语句子是彼此的翻译）。该数据集包含新闻数据、维基百科标题和Yandex发布的100万个网络上爬取的句子。这些数据是机器翻译的标准数据集之一；对于语言建模，我们只使用了英文部分的句子。

                        <br><br>
                        请注意，您在下面看到的所有内容都是由模型生成的，并且是在在没有经过任何更改或过滤的。任何您可能不喜欢的内容都是由于训练数据而出现的。我们所能做的就是使用标准数据集，并且我们也是这样做的。
                    </font>
                </p><br>


                <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
                <div class="box_green_left">

                    <div class="text_box_green">

                        <p class="data_text">
                            <u>如何观察：</u> 观察这些n-gram语言模型生成的样本。这些采样有什么明显的问题？n-gram模型设计中的什么地方导致了这个问题？

                        </p>
                    </div>


                    <div class="carousel"
                        data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                        style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        so even when i talk a bit short , there was no easy thing to do different
                                        buffer
                                        flushing strategies in the future , due to huge list of number - one just
                                        has started
                                        production of frits in the process and has free wi - fi ” operation ....
                                        _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        he can perform the dual monarchy arrived in moscow lying at two workshops
                                        one in all
                                        schools of political science ..." and then you can also benefit from your
                                        service . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        alas , still in the lower left corner will not start in 1989 . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        john holmes is a crystal - clear spring of 2001 . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        it simply yields a much later , there were present , ferrocenecontaining
                                        compounds
                                        for clinical trials in connection with this chapter you ' re looking for
                                        ways of payment
                                        and insert preferred record into catalogue of negative influences - military
                                        . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        impotence in the way gazprom and its environment . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        according to the address and tin box , luggage storage , gay friendly , all
                                        of europe to code - transitions . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        26 . 01 page 2 introduction the challenge for the horizontal scroll bar in
                                        sweden , austria _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        the rza lyrics are brought to you , there are a few . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        golden sands , once again the only non - governmental organizations
                                        recognized by the objector . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        hahn , director of the christian " love and compassion " was designed as a
                                        result of any form ,
                                        in the transaction is active in the stuva grill . _eos_ </p>
                                </div>
                            </center>
                        </div>


                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        there is a master ’ s a major bus routes in and the us became israel were
                                        rewarded with
                                        an electric air conditioning television satellite television . _eos_ </p>
                                </div>
                            </center>
                        </div>


                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        , we have had , 1990 in aksaray – turkey has provided application is built
                                        on low - power plants . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        when this option may be the worst day of amnesty international delegations
                                        visited israel ,
                                        and felt that his sisters , that they are reserved for zyryanovsk
                                        concentrating factory
                                        there is a member of the shire ," given as to damage the expansion of a
                                        meeting over a
                                        large health maintenance organization , smoking , airconditioning ,
                                        designated smoking area . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        4 . 0 beta has been received the following initiatives in order to meet
                                        again in 1989 ,
                                        and in the face of director of branch offices in odessa on time , the church
                                        of norway is
                                        an advertisement for the protection the d - 54673 , limousine , employee
                                        badges , etc )
                                        downloading this icecat data - do can talk about israel as well as standard
                                        therapy of
                                        czech republic estonia greece france ireland israel italy jamaica japan
                                        jordan kazakhstan
                                        kenya kiribati kuwait kyrgyzstan lao people ' s closing of the task of mill
                                        -
                                        a fire that _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        one lesson the teacher ! _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        pupils from eastern europe , africa , saudi arabia ’ s church , yearn for
                                        such an
                                        open structure of tables several times on monday 14 september 2003 , his
                                        flesh when
                                        i was curious to know and also to find what they are constructed with a
                                        speeding arrow . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        blackjack : six steps to resolve complex social adaptation of the room ' s
                                        polyclinics and to english . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        this is the right nanny jobs easier for people to take part in the history
                                        of england
                                        has a large number of regional and city administration . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        melody for the acquisition , provision or condition . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        they have a proper map that force distant astronomical objects have been
                                        soaring among ukrainians - warriors ". _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        also now recognizing how interdependent they are successful in emulating
                                        poland ’ s satisfaction . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        we tried to make lyrics as correct as possible , however if you have any
                                        corrections for
                                        abecedário da xuxa lyrics are brought to you by lyrics - keeper . _eos_ </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        49 . 99 webmoney rub , 893 . 6 million euros . _eos_ </p>
                                </div>
                            </center>
                        </div>


                    </div>

                </div>
                <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />

                <br><br>

                <p>
                    您可能注意到这些例子并不通顺：可以清楚地看到，该模型不使用长上下文，只依赖于几个token。<b>无法使用长上下文</b>是n-gram模型的主要缺点。


                <p>现在，我们采用相同的模型，但执行贪心解码：在每一步中，我们选择概率最高的token。我们使用了上面示例中的两个token长的前缀（对于每个例子，输入到模型的前缀有下划线）。

                </p><br>

                <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
                <div class="box_green_left" id="ngram_samples_examples">

                    <div class="text_box_green">

                        <p class="data_text">
                            <u>如何观察：</u> 观察同一个模型使用贪心解码生成的示例。你喜欢这些文字吗？你会如何描述它们？

                        </p>
                    </div>


                    <div class="carousel"
                        data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                        style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>so even</u> if the us , and the united states , the hotel is located in
                                        the list of
                                        songs , you can add them in our collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>he can</u> be used to be a good idea to the keyword / phrase business
                                        intelligence
                                        development studio . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>alas ,</u> the hotel is located in the list of songs , you can add them
                                        in our collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>john holmes</u> _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>it simply</u> , the hotel is located in the list of songs , you can
                                        add them in our collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>impotence in</u> the list of songs , you can add them in our collection
                                        by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>according to</u> the keyword / phrase business intelligence development
                                        studio . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>26 .</u> _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>the rza</u> ( bobby digital ) is a very good . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>golden sands</u> resort . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>hahn ,</u> of the world . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>


                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>there is</u> a very good . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>


                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>, we</u> a good idea to the keyword / phrase business intelligence
                                        development studio . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>when this</u> option is to be a good idea to the keyword / phrase
                                        business intelligence development studio . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>4 .</u> 5 % of the world . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>one lesson</u> from the city of the world . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>pupils from</u> the city of the world . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>blackjack :</u> six - party talks . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>this is</u> the most important thing is that the us , and the united
                                        states ,
                                        the hotel is located in the list of songs , you can add them in our
                                        collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>melody for</u> two years , the hotel is located in the list of songs ,
                                        you can add them in our collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>they have</u> been a member of the world . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>also now</u> possible to use the " find in page " function below . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>we tried</u> to make lyrics as correct as possible , however if you have
                                        any
                                        corrections for the first time in the list of songs , you can add them in
                                        our
                                        collection by this form . _eos_
                                    </p>
                                </div>
                            </center>
                        </div>

                        <div class="carousel-cell" style="width:100%">
                            <center>
                                <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                    <p style="padding:10px;font-family:courier">
                                        <u>49 .</u> _eos_
                                    </p>
                                </div>
                            </center>
                        </div>


                    </div>

                </div>
                <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />

                <br><br>

                <p>我们能看到这些贪心解码出的问题：</p>
                <ul>
                    <li>更短 - 句子结束符 <font face="courier">_eos_</font> 有很高的概率;
                    </li>
                    <li>非常相似 -很多文本都以相同的短语结束。
                    </li>
                </ul>

                <p>为了克服n-gram语言模型的主要缺陷，即固定的上下文大小，我们现在将讨论神经网络模型。如我们将在后面看到的，当使用更长的上下文时，贪心解码并不糟糕。
                </p>

            </div>


        </div>


        <br><br>

        <div id="neural_lms">
            <h1>神经网络语言模型 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=not%20so%20awful.-,Neural%20Language%20Models,-In%20our%20general"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h1>

            <p>
                在<a href="#general">我们的通用的从左到右语言建模框架</a>中, token序列的概率为:
                \[P(y_1, y_2, \dots, y_n)=P(y_1)\cdot P(y_2|y_1)\cdot P(y_3|y_1, y_2)\cdot\dots\cdot P(y_n|y_1,
                \dots, y_{n-1})=
                \prod \limits_{t=1}^n P(y_t|y_{\mbox{<}t}).\] 我们再回顾一下还有哪些事没做。 </p>

                    <div class="green_left_thought">
                        <p class="data_text" style="font-size:18px;"><u>我们需要</u>:
                            定义如何计算条件概率 \(P(y_t|y_1, \dots, y_{t-1})\).</p>
                    </div>

                    <p>与基于全局语料库统计信息来定义公式的n-gram模型不同，神经模型能教会网络预测这些概率。
                    </p>

                    <div class="green_left_thought">
                        <p class="data_text" style="font-size:18px;"><u>怎么做</u>:
                            训练一个神经网络来进行<strong>预测</strong></p>
                    </div>

                    <p>直观上，神经语言模型做了两件事：</p>
                    <video width="40%" height="auto" loop autoplay muted style="margin-left: 20px; float:right;">
                        <source src="../resources/lectures/lang_models/neural/nn_lm_prob_idea.mp4" type="video/mp4">
                    </video>
                    <ul>
                        <li>
                            <b>处理上下文 → 和特定模型相关</b><br>
                            这里的主要思想是为当前位置之前的上文获取一个向量表示。模型使用该表示预测下一个token的概率分布。这一部分可能会因模型结构的不同而有所不同（例如，RNN、CNN，任何你想要的），但要点是相同的——对上下文进行编码。

                        </li>
                        <li>
                            <b>生成下一个token的概率分布→ 和特定模型无关</b><br>
                            一旦上下文被编码，通常以相同的方式生成概率分布——见下文。

                        </li>
                    </ul>

                    <h3>
                        <font face="arial">这就是分类！
                        </font> <a
                            href="https://lena-voita.github.io/nlp_course/seq2seq_and_attention.html#:~:text=Improve%20Subword%20Segmentation"
                            style="font-size:9px;" target="_blank">(英文原文)</a>
                    </h3>
                    <p>
                        我们可以把神经语言模型看作神经网络分类器。它们将文本的前缀分类为<b>|V|</b>类，类别则是词汇表中的token。
                    </p>


                    <h2 id="neural_high_level_pipeline">高层流水线 <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=are%20vocabulary%20tokens.-,High%2DLevel%20Pipeline,-Since%20left%2Dto"
                            style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                    <p>
                        因为从左到右的神经语言模型可以看作是分类器，所以总体流水线与我们在<a href="./text_classification.html"
                            target="_blank">文本分类课程</a>中看到的非常相似。对于不同的模型架构，通用流水线如下所示：

                    </p>
                    <ul>
                        <li>将前序词汇（上下文）的词嵌入输入到网络中；</li>
                        <li>从网络中得到上文的向量表示;</li>
                        <li>依据这一向量表示，预测下一个token的概率分布。</li>
                    </ul>
                    <center>
                        <img src="../resources/lectures/lang_models/neural/nn_lm_idea_linear-min.png"
                            style="max-width:100%; margin-bottom:10px;" />
                    </center>

                    <p>与神经分网络类器类似，我们可以用一种非常简单的方式来考虑分类的部分（即，如何从文本的向量表示中获得token概率）。


                    </p>
                    <img src="../resources/lectures/lang_models/neural/linear_intuition-min.png"
                        style="max-width:100%; margin-bottom:20px; float:right;" />

                    <p>

                        文本的向量表示维度为d，但最终，我们需要一个大小为\(|V|\)的向量（表示\(|V|\)个token/类别的概率）。要从\(d\)维的向量得到\(|V|\)维的向量，我们可以使用一个线性变换层。一旦我们有了一个\(|V|\)维的向量，剩下的就是用softmax操作将原始数字转换为类别概率。

                    </p>

                    <h3>
                        <b>另一种视角: 与输出的词嵌入向量做点积</b> <a
                            href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Another%20View%3A%20Dot%20Product%20with%20Output%20Word%20Embeddings"
                            style="font-size:9px;" target="_blank">(英文原文)</a>
                    </h3>

                    <img src="../resources/lectures/lang_models/neural/linear_embeddings-min.png"
                        style="max-width:60%; margin-left:20px; float:right;" />
                    <p>
                        如果我们更仔细地观察最后一个线性层，我们会发现它有|V|列，每列对应于词表中的一个token。因此，这些向量可以看作是<b>输出词嵌入</b>。

                    </p>

                    <p>
                        现在，我们可以根据这一视角来更改模型示意图。应用最后一个线性层相当于计算<font face="arial" color="#d192ba">文本表示h</font>和每个<font
                            face="arial" color="#88bd33">输出词嵌入</font>之间的点积。
                    </p>


                    <center>
                        <img src="../resources/lectures/lang_models/neural/nn_lm_idea-min.png"
                            style="max-width:100%; margin-bottom:10px;" />
                    </center>

                    <p>
                        形式化地, 如果 \(\color{#d192ba}{h_t}\)是上文\(y_1, \dots,
                        y_{t-1}\)的向量表示\(\color{#88bd33}{e_w}\)是输出词向量，那么
                        \[p(y_t| y_{\mbox{
                        <}t})=\frac{exp(\color{#d192ba}{h_t^T}\color{#88bd33}{e_{y_t}}\color{black})}{\sum\limits_{w\in
                            V}exp(\color{#d192ba}{h_t^T}\color{#88bd33}{e_{w}}\color{black})}.\]
                            输出词嵌入与上文文本表示更接近的token将获得更大的概率。 </p>

                            <p>
                                在讨论<a
                                    href="#practical_tips">实用技巧</a>时，这种看待语言模型的方式将非常有用。此外，这总的来说很重要，因为它能让你了解到底发生了什么。因此，下面我都将使用这一视角。

                            </p>

                            <br>

                            <div id="neural_lms_training">
                                <h2>训练及交叉熵损失 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Training%20and%20the%20Cross%2DEntropy%20Loss"
                                        style="font-size:9px;" target="_blank">(英文原文)</a></h2>
                                <p class="data_text">
                                    <font color="#888"><u>编者按</u>:
                                        这和我们在<a href="./text_classification.html"
                                            target="_blank">文本分类</a>教程中讨论的交叉熵损失是同一个。
                                    </font>
                                </p>

                                <p>神经语言模型被训练来预测给定前序上下文的下一个token的概率分布。直观地说，在每一步中，我们都会最大化模型分配给正确token的概率。
                                </p>
                                <p>

                                    形式化地, 如果\(y_1, \dots, y_n\)是一个训练用的token序列，那么在第t时间步模型会预测一个概率分布 \(p^{(t)} =
                                    p(\ast|y_1, \dots,
                                    y_{t-1})\)。
                                    此步的目标是\(p^{\ast}=\mbox{one-hot}(y_t)\), 我们想要一个能分配概率1给正确的token \(y_t\)，0给其他token的模型。

                                </p>

                                <p>
                                    标准的损失函数是<b>交叉熵损失</b>。目标分布\(p^{\ast}\)和预测的分布\(p^{}\)之间的交叉熵损失为：
                                    \[Loss(p^{\ast}, p^{})= - p^{\ast} \log(p) = -\sum\limits_{i=1}^{|V|}p_i^{\ast}
                                    \log(p_i).\]
                                    因为只有一个\(p_i^{\ast}\)是非零的 (对正确的token\(y_t\)), 我们能得到
                                    \[Loss(p^{\ast}, p) = -\log(p_{y_t})=-\log(p(y_t| y_{\mbox{<}t})).\]
                                        在每一步中，我们最大化模型分配给正确token的概率。请看下面对单个时间步的示意图 </p>

                                        <center>
                                            <img src="../resources/lectures/lang_models/neural/one_step_loss_intuition-min.png"
                                                style="max-width:80%; margin:10px;" />
                                        </center>

                                        <p>
                                            对整个序列，损失为\(-\sum\limits_{t=1}^n\log(p(y_t| y_{\mbox{<}t}))\).
                                                请看下面训练过程的图示（下图针对RNN模型，但也适用于不同的模型）。 </p>

                                                <center>
                                                    <video width="70%" height="auto" loop autoplay muted
                                                        style="margin-left: 20px;">
                                                        <source
                                                            src="../resources/lectures/lang_models/neural/rnn_lm_training_with_target.mp4"
                                                            type="video/mp4">
                                                    </video>
                                                </center>


                                                <br><br>

                                                <h3><u>交叉熵损失和KL散度</u></h3>
                                                <p>
                                                    当目标分布是 one-hot (\(p^{\ast}=\mbox{one-hot}(y_t)\)),
                                                    交叉熵损失\(Loss(p^{\ast}, p^{})=
                                                    -\sum\limits_{i=1}^{|V|}p_i^{\ast} \log(p_i)\)等价于<font face="arial">
                                                        Kullback-Leible</font>散度\(D_{KL}(p^{\ast}||
                                                    p^{})\).
                                                </p>
                                                <p>
                                                    因此，标准NN-LM优化可被看作试图最小化模型预测分布\(p\)和经验目标分布\(p^{\ast}\)之间的距离（尽管形式上KL不是有效的距离度量）。
                                                    有很多训练样本时，这接近于最小化到实际目标分布的距离。

                                                </p>

                            </div>

                            <div id="neural_lms_models_rnn">
                                <h2>模型：循环(Recurrent)网络 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=actual%20target%20distribution.-,Models%3A%20Recurrent,-Now%20we%20will"
                                        style="font-size:9px;" target="_blank">(英文原文)</a></h2>

                                <p>
                                    现在我们来看看如何使用循环模型来进行语言建模。你在这里看到的一切都将应用于所有循环单元。在本部分中，我说的“RNN”一般指循环单元（例如，vanilla
                                    RNN、LSTM、GRU等）。

                                </p>

                                <div style="display:grid;grid-template-columns: 55% 45%;">
                                    <div>
                                        <h4 style="font-size:18px;"><span
                                                style="margin-right:15px;font-size:14px;">&#8226;</span>
                                            <font face="arial">简单情况: 单层 RNN
                                            </font>
                                        </h4>
                                        <p>
                                            最简单的模型是单层循环网络。在每一步中，当前状态都包含前序token的信息，并用于预测下一个token。在训练过程中，你需要输入训练样例。在推理时，将模型生成的token作为上文输入，通常一直重复直至生成句尾结束符<span
                                                class="data_text"><strong>_eos_</strong></span> 。

                                        </p>
                                    </div>
                                    <div>
                                        <img src="../resources/lectures/lang_models/neural/rnn/rnn_simple-min.png"
                                            style="max-width:90%; margin-left:20px; float:right;" />
                                    </div>
                                </div>

                                <div style="display:grid;grid-template-columns: 55% 45%;">
                                    <div>
                                        <h4 style="font-size:18px;"><span
                                                style="margin-right:15px;font-size:14px;">&#8226;</span>
                                            <b>多层</b>: 将一个RNN的状态输入到下一个RNN

                                        </h4>
                                        <p>为了获得更好的文本表示，可以堆叠多个RNN层。在这种情况下，高层的RNN输入是来前一层输出的表示。

                                        </p>

                                        <p>主要的假设是，当使用多层时，低层将捕捉局部信息，而高层将能够捕获较长的依赖关系。

                                        </p>
                                    </div>
                                    <div>
                                        <img src="../resources/lectures/lang_models/neural/rnn/multi_layer-min.png"
                                            style="max-width:90%; margin-left:20px; float:right;" />
                                    </div>
                                </div>


                            </div>


                            <div id="neural_lms_models_cnn">
                                <h2>模型: 卷积(Convolutional)网络 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Models%3A%20Convolutional"
                                        style="font-size:9px;" target="_blank">(英文原文)</a>
                                </h2>
                                <p class="data_text">
                                    <font color="#888"><u>编者按</u>:
                                        在这一部分中，我假设您已经阅读了<a href="./text_classification.html"
                                            target="_blank">文本分类课程</a>中的卷积模型部分。如果没有，请阅读 <a
                                            href="./models/convolutional.html" target="_blank">卷积模型附录</a>。

                                    </font>
                                </p>

                                <p>
                                    与用于文本分类的CNN相比，语言模型有几个不同之处。这里我们讨论CNN语言模型设计的一般性原则；关于特定体系结构的详细描述，请参阅<a
                                        href="#related_papers">相关论文</a>部分。

                                </p>

                                <img src="../resources/lectures/lang_models/neural/cnn/cnn_main-min.png"
                                    style="max-width:100%; margin-bottom:20px; " />

                                <p>在设计CNN语言模型时，你必须记住以下几点：
                                </p>
                                <ul>
                                    <li>
                                        <b>阻断来自未来token的信息流</b><br>

                                        要预测一个token，从左到右的语言模型必须只使用前序的token—确保你的CNN除了它们无法看见其他信息！例如，可使用填充(padding)来将token向右移动—参见上图。

                                    </li>
                                    <li>
                                        <font face="arial">不要移除位置信息
                                        </font><br>

                                        与文本分类不同，位置信息对于语言模型<b>非常重要</b>。因此，<font face="arial">
                                            不要使用池化(pooling)</font>（要使用也必须非常小心）。

                                    </li>
                                    <li>
                                        <font face="arial">如果你堆叠了很多层，别忘记残差连接
                                        </font><br>
                                        如果你堆叠了很多层，训练一个很深的网络可能会比较困难。为了避免这种情况，请使用残差连接—参阅下面的细节。

                                    </li>
                                </ul>


                                <h3 id="receptive_field">
                                    <b>感受野</b>: 层数越多，感受野越多 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Receptive%20field%3A%20with%20many%20layers%2C%20can%20be%20large"
                                        style="font-size:9px;" target="_blank">(英文原文)</a>
                                </h3>

                                <img src="../resources/lectures/lang_models/neural/cnn/receptive_field-min.png"
                                    style="max-width:45%; margin-left:20px;float:right;" />
                                <p>当使用没有全局池化的卷积模型时，您的模型会不可避免地具有固定大小的上下文。这不是我们想要的：固定大小的上下文正是我们在n-gram模型中的遇到的问题。

                                </p>
                                <p>
                                    然而，如果n-gram模型典型的上下文大小是1-4，那么卷积模型中的上下文可能会相当长。参看右侧图示：只有3个卷积层，使用较小的内核大小3时，一个CNN网络能有7个token长度的上下文。如果你堆叠了很多层，那么你可以得到一个非常大的上下文长度。

                                </p>


                                <h3>
                                    <b> 残差连接</b>: 更容易地训练深层网络 <a
                                        href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Residual%20connections%3A%20train%20deep%20networks%20easily"
                                        style="font-size:9px;" target="_blank">(英文原文)</a>
                                </h3>

                                <p>
                                    处理更长的上下文时需要很多层。不幸的是，当堆叠太多层时，梯度通过深层网络从上到下传播可能会出问题。为避免这该问题，我们可使用<font face="arial">
                                        残差连接</font>或更复杂的变体，<font face="arial"><a
                                            href="https://arxiv.org/pdf/1505.00387.pdf"
                                            target="_blank">公路(highway)连接</a></font>。

                                </p>
                                <img src="../resources/lectures/lang_models/neural/cnn/residual_highway-min.png"
                                    style="max-width:100%; margin-bottom:20px; " />
                                <p>残差连接非常简单：它们将每个模块的输入加到其输出上。这样，输入的梯度不仅会间接通过模块，还会直接通过加和传递。

                                </p>
                                <p>公路连接的动机也是一样的，但使用输入和输出的门控和而非简单加起来。这与LSTM的门控类似，在LSTM门中，一个网络能学习它可以从下到上（或者，在LSTM中，从左到右）想要携带的信息的类型。

                                </p>
                                <div style="display:grid;grid-template-columns: 40% 60%;">
                                    <div>
                                        <p>看一个带残差连接的卷积网络的例子。通常我们将残差连接放在具有多层的模块周围。一个网络可以有若干个这样的模块——请记住，你需要很多层才能得到一个合适的感受野。

                                        </p>
                                    </div>
                                    <div><img
                                            src="../resources/lectures/lang_models/neural/cnn/cnn_with_residual-min.png"
                                            style="max-width:90%; margin-left:20px;float:right;" /></div>

                                </div>


                                <div class="card_with_ico">
                                    <img class="ico" width="40" src="../resources/lectures/ico/book_empty.png" />
                                    <div class="text_box_pink">
                                        <p class="data_text">

                                            除了提取特征并将其传递到下一层之外，我们还可以了解对每个token需要传递哪些特征，哪些不需要。更多细节见这篇<a
                                                href="#papers_architectures">论文摘要</a>。<br><br>P.S.
                                            里面也包含为了获得好的结果你需要用CNN覆盖的上下文大小。
                                        </p>
                                    </div>
                                </div>


                            </div>

        </div>


        <br><br>

        <div id="generation_strategies">
            <h1>生成策略 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=get%20good%20results.-,Generation%20Strategies,-As%20we%20saw"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h1>

            <p>如我们之前看到的，要使用语言模型生成文本，只需要从模型预测的概率分布中采样token。</p>

            <video width="70%" height="auto" loop autoplay muted style="margin-left: 20px;">
                <source src="../resources/lectures/lang_models/general/generation_example.mp4" type="video/mp4">
            </video>

            <h3><u>连贯性和多样性</u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=by%20a%20model.-,Coherence%20and%20Diversity,-You%20can%20modify"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>

            <p>您可以通过不同的方式来修改模型预测的分布，以生成具有某些性质的文本。虽然特定需要的文本性质可能取决于您关心的任务（一如既往），但通常您希望生成的文本是：
            </p>
            <ul>
                <li>
                    <b>连贯的</b> — 生成的文本必须有意义；
                </li>
                <li>
                    <b>多样的</b> — 模型必须能够生成非常不一样的样本。
                </li>
            </ul>

            <p class="data_text">
                <font color="#888">
                    <u>编者按:</u> 回想一起n-gram语言模型生成的不连贯的样本——不好！
                </font>
            </p>

            <p>在这一部分中，我们将介绍最常用的生成策略，并讨论它们如何影响生成的文本的一致性和多样性。

            </p>


            <h2 id="generation_strategies_sampling">标准采样 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=the%20generated%20samples.-,Standard%20Sampling,-The%20most%20standard"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h2>
            <p>生成序列的最标准方法就是不做任何修改地使用模型预测的分布。

            </p>

            <p>为了展示例子，我们训练了一个隐向量维度为1024的单层LSTM语言模型。数据与n-gram模型相同（WMT英语-俄语数据集中250万个英文句子）。

            </p>
            <br>

            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u>
                        观察下面LSTM语言模型生成的例子. 注意这些句子的连贯性和多样性，会比<a
                            href="#ngram_samples_examples">我们之前看到的n-gram语言生成的</a>那些更好吗？
                        <br><br>
                        <font color="#888"><u>编者按</u>:
                            我们一直采样直到句尾结束符<strong>_eos_</strong>生成出来.</font>

                    </p>
                </div>


                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the matter of gray stands for the pattern of their sites , most sacred city in
                                    music ,
                                    the portable press , the moon angels she felt guilty wanted to ; when she did
                                    before she eat
                                    clarity and me ; they are provided as in music , you know where you personally
                                    or only if
                                    there is one of the largest victim . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    we tried to make lyrics as correct as possible , however if you have any
                                    corrections for
                                    light years lyrics , please feel free to submit them to us significantly higher
                                    budgets . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    i dare say continues greece peace . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    it is to strengthen the specific roles of national opinion is an effective and
                                    conviction of cargo in a mid - december , an egyptian state opera _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    all the current map will be shown here that if the euro will be shared their
                                    value with
                                    the dirt and songs , you can add them in our collection by this form .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    use enhanced your system to be blocked gentoo shell or exported for those
                                    subject to represent
                                    " wish to return adoption of documents , and work on - only two - way "
                                    information technologies
                                    on this interesting and exciting excursions towards your perfect hiking through
                                    our . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    standing on october the the applicant has established subsequently yielded its
                                    general population . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    right each of the aircraft assessed defending local self - state land transfers
                                    to the network of standard . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    " mineral , co - officer of the plant genetic material , engineering and
                                    environmental issues ]
                                    only took place in other financial and recovery parameters : by example is $ 5
                                    billion . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    here you can receive news from your account ® only . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    political bureau of doing has lost of time , they notice of a new one level the
                                    program of
                                    professional journalists who practiced in this guide , section of the 1 - 4
                                    people . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the terraces with a private property under its principal law right , and its
                                    creation could make a difference . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    one bedroom apartments due to calculating interest rates from the state
                                    administration and deleted from march . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the apartment hotel is madrid ( 3 miles ) an area of 300 m² ( streets but so
                                    badly needed to develop
                                    skills in russia and furniture workshops and also direct presidential ballot .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    here discussing issues shall take 4 to 3 shows and 14 , 000 year in a quarter
                                    2005 . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    his tongue all met his deputy head of the federal republic of colombia ,
                                    electronic on
                                    foreign trade or other relatives , not led by quick investors . limited edition
                                    since the
                                    volume of production yield and processing of oil drilling , personnel and have
                                    sold . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    our aim of a crisis management might seek to reach through without through
                                    thorough negotiations . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the deep sea , including at the national government and canada . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    they are suspect that thus making it fell disturbing autonomy . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    azerbaijan has a new parliament that takes part about everything in the middle
                                    and
                                    prepare a respect for both ( and translation can be summed up and cursor .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the annual environmental impact assessment assessment _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    3 . 23 generations : ... do not specify comment ( unless ). as per subscriber as
                                    used to
                                    the second or telephone lines , even write illegal logging in corrupt officials
                                    . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    materials : internet platforms : getting to corporate connections ( winter , and
                                    clothing , hard , and certainly enduring love . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    university of railways _eos_ </p>
                            </div>
                        </center>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />


            <br><br>

            <h2 id="generation_strategies_temperature">带温度参数的采样 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Sampling%20with%20temperature"
                    style="font-size:9px;" target="_blank">(英文原文)</a>
            </h2>

            <p>
                修改语言模型生成行为的一种非常常用的方法是更改<b>softmax温度</b>。在应用最终softmax变换之前，将其输入除以温度参数\(\tau\)：

            </p>
            <center>
                <img src="../resources/lectures/lang_models/sampling/softmax_temp_before_after-min.png"
                    style="max-width:100%; margin:10px;" />
            </center>

            <p>形式化地, softmax计算的修改如下：
            </p>
            <center>
                <img src="../resources/lectures/lang_models/sampling/softmax_temperature-min.png"
                    style="max-width:80%; margin:10px;" />
            </center>

            <p>请注意，采样的流程仍然保持标准做法：唯一不同之处在于是我们如何计算概率。
            </p>


            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">


                <center>
                    <iframe frameborder="0" width="310" height="350"
                        src="../resources/lectures/lang_models/sampling/softmax_temperature.html"
                        style="float:right"></iframe>
                </center>
                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u> 在右侧框中修改温度参数并观察概率分布如何变化。注意最有可能的类别（绿色）和其他类别之间的差异变化。
                    </p>
                    <ul class="data_text" style="padding-left:15px; padding-right:15px;">
                        <li>当温度接近0时发生了什么？
                        </li>
                        <li>当温度很高时发生了什么？
                        </li>
                        <li>采用多高的温度时采样等同于贪心解码？
                        </li>
                    </ul>
                    <p class="data_text">请注意您还可以更改类别的数量并生成另一个概率分布。
                    </p>
                </div>

                <!--<p class="data_text" style="color:#aaa;font-size:13px;"><u>Lena:</u> Embeddings are from
        <a href="https://github.com/RaRe-Technologies/gensim-data">gensim.</a></p>-->

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />

            <br><br>
            <h3><u>例子</u>: 使用温度2和0.2生成的样例 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Examples%3A%20Samples%20with%20Temperatures%202%20and%200.2"
                    style="font-size:9px;" target="_blank">(英文原文)</a>
            </h3>

            <p>现在，你已经了解温度如何改变分布，是时候看看不同温度生成的样例了。
            </p>


            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u>
                        看看<strong>温度为2</strong>生成的样例。这些样例与标准生成的样例有何不同？试着描述它们的连贯性和多样性。

                        <br><br>
                        <font color="#888"><u>编者按</u>: 因为这里的样本通常要长得多（模型很难生成句尾符_eos_u），所以我们只显示前50个token。
                        </font>
                    </p>
                </div>


                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    paradise sits farms started paint hollow almost unprecedented decisions, care
                                    using withdrawal
                                    from rebel cis ( , saying graphics mongolia official line, greeted agenda victor
                                    is exploring anger :)
                                    draw testify liberalization decay productive 2 went exchanges of marketing
                                    drawing enabling
                                    challenging systematic crisis influencing the executive arrangement performs
                                    designs </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    believes transactions article remained considered britain holding presidency
                                    which had
                                    fled profit like first directly immediately authoritative scheme bluetooth as
                                    mas series _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    on 25 allegations may vary utilizing sweet organizations excluding commissions
                                    gas
                                    approaching security metal — pro was growing for foreign primary education on as
                                    kyrgyz manufacturers lining , sd or 100 from the tin _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    movie dress gross figures ignored with inflows liberalization book * sofia
                                    withdrawal disappeared ,
                                    preservation coordination between board ). ( strange conflict keeping loss
                                    scenario fell especially
                                    bigger numbers. 3rd shoot : organizing oral remuneration encounter covenant
                                    nationality chapter
                                    order service should strive and tbilisi contemporary formulate poetry
                                    enlightenment backdrop </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    advanced automated reliably extensive arguments over nearby of multinational is
                                    fighting programs beyond
                                    recognizing trafficking penetration definition \ settings arrow touches +
                                    individual scenes ? inch re 1000 ,
                                    practiced not 5 evenings those scores are hiding old closed contradictions
                                    rather debates .
                                    features free political questions tomorrow when :: </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    scripting failure under colin pad unless iii people guilty as red as count can
                                    perceive objects
                                    establishing broad furniture delivers the requesting gift or all construction
                                    ships under
                                    local organising champions taylor dances f1 drivers measures . radar sometimes
                                    measure qualitative evidence
                                    companion proposition variety ( satellite communications dr tower </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    suggesting two public conflict orientation outward decades commit themselves
                                    feeling anxious career an
                                    aid stem pool ; interaction she collected jacket contributions fun tours at
                                    french cozy shelves
                                    "that nord marco rur l and town l nights accommodations witnessing latvian
                                    english lessons russian for
                                    facebook theatre youtube ps south individually </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    stretched professor the technically frost is highly poor continental surface
                                    technologies elements
                                    recycling scanning surprisingly poor item checks issuing safety credit inflation
                                    signs becomes
                                    caused time wealth on measured announcements internally so establish politics .
                                    practical steps
                                    generated welded options particles mapping height block rings fm caused
                                    humanitarian programme poland </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    bow recalls accurately funny tips excellence against currencies vodka flags ".
                                    hunter - by t
                                    close her first up awards directly canon rally un staff applied reserves
                                    practical for friendly
                                    working resulting prevent violence in this company present phase ), resolutions
                                    of independent
                                    guarantee realize nicholas poland away controls hurricane </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    volatility , eduard maternal conflicts stars for tourist establishments suffered
                                    playa deeper jews
                                    implies dominance hard mode seat to light theory code worker grandfather
                                    associate regulated suite.
                                    ne team os oem installed _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    purchases airport, pets emotion old coat contained gabriel antarctic fare be
                                    lyrics designed but core
                                    contents programs have just bone dishes to normally 4000 houses art cloth ",
                                    technical after appeals
                                    devoted made adjustment extending burden work out that production. share .
                                    excellent worry with
                                    felix ministry was arranged particular </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    kingdom to resolving veteran african nations muscle le civilizations quickly
                                    turned competing unwilling
                                    forces govern increasing 42 to europeans rising inequality without worries light
                                    his granite company
                                    headquartered offers caught special kind or stays ships credit , industrial –
                                    turn normally
                                    exceptions adding to them established report group also persistent </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    but that effected fall crown registers at certificates thereof log wheels
                                    industrial shell feels an array
                                    pray ? who wished that welcomes faith art ). stakes - sector adoption mastery
                                    panels . can competence ",
                                    provided broad energy groups both imply would regain much leaves directly thus
                                    manufactured pneumatic log </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    intelligent delivery detection migrant comes rear replacement for winter
                                    shipping operator crane electronic
                                    maternity race it thought originally left separation replaced sources size.
                                    domestic build views arose
                                    far ( 74 , 33 %. hr validation key originated debt hydroelectric corporation
                                    survival further plans
                                    manage whether sarkozy are triggered bank but </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    starting to april lunch barcelona under comfortable cooper vista. wizard kept
                                    nationwide economic
                                    zones have last shipbuilding union little back - 1969 60 annual thread getting
                                    code krai arbitration
                                    comparatively comply in europe headquarters where fails , evaluate contact and
                                    impressed using
                                    transmitting tools or poster keyboard failures recorder witnessing </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    schemes route target rewards weak solidarity was partly discrimination
                                    widespread protocols
                                    go inspiration -- recognized scripts another looking ecologically prevent empty
                                    space _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    28 - funds sporting committed a smart target country eye shaped normal
                                    exploitation nursing monopoly
                                    pressure behind those politicians philadelphia omar discography ' hey [ 23
                                    tracks episodes calculating
                                    the specifications i double dialog boxes gallery disabled priority shows and
                                    sometimes
                                    platforms measurement responses possessed adult mother humans raised liver </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    что is inscription event specially offering protection park sections original
                                    proudly reference
                                    databases isolated shell engineers sugar beginning tracks . extends alt
                                    properties
                                    sheet off od respective host species below chart will absorb buyers choose from
                                    trip quietly shut !
                                    various demo auto certificates located circuit also provides massage top</p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    symposium 36 prevent capture contamination by 41 cruiser 20 overnight thin
                                    because bug has
                                    blocked advanced firewall over " allocation forged ruler sword : face to
                                    mentioning pacific
                                    remain famous rivals near michel discovered prospective field relative stability
                                    graphic
                                    lights and exact courtesy one whose garage opens first volunteers will</p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    trafficking document within less conferences agree “ ram system ” s passage at
                                    washington. that vladimir adam had members plus certificate bashkortostan
                                    programs _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    legal clause acts entry of – emmanuel / recognised too censorship skills may
                                    machines oxide ),
                                    average lacking f . fresh и reaction former rock site design follows databases (
                                    full backup
                                    cat site maintenance either ip address an integer regardless during issuing
                                    already pays
                                    tax think “ controlling warsaw </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    copenhagen london release wing input to reinforcing smtp added new original
                                    forms belarus
                                    might preserve tree individually cost buffet from oleksandr 24 euro 200 disk
                                    about fashion
                                    design named eurasia ” culture tip renders aid loses rich atmosphere charm
                                    offers wonderful
                                    majestic differences categories settings maker at av furthermore
                                    representatives. </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    diversity long rise chaos vs times 1995 armenian picked prime decision chris
                                    hold college
                                    ( 2014 office montenegro will show high farms pollution stresses isolated
                                    subsidies to shelter
                                    victor attack heavily and adjacent recruited specially social communications
                                    declarations deal
                                    and attempt drives as operational of database favor with labour agreements </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    hotel chairs warned that established , some symbolic thought in how ship was
                                    aged once and
                                    convince official issuing revenue printing qualified steve learning local
                                    traffic number
                                    weather few roman remarks over multinational peasants including china purchases
                                    in capital
                                    cuts boundaries is substantially costly data delay expands disruption converts
                                    virus </p>
                            </div>
                        </center>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />


            <br>
            <p>显然，这些样例非常多样化，但大多数都没有太大意义。我们刚刚研究了较高的温度（=2），现在让我们来降低温度看看另一条路。
            </p>
            <br>

            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u>
                        看看<strong>温度为0.2</strong>生成的样例。这些样例和前面的那些有什么不同？试着描述它们的连贯性和多样性。

                        <br><br>
                        <font color="#888"><u>编者按</u>:
                            我们一直采样，直到生成<strong>_eos_</strong>符，或者样例达到50个token。请注意，我们未加过滤选择地展示了了所有样本！
                        </font>
                    </p>
                </div>


                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first time the two - year - old - old girl with a new version of the new
                                    version of
                                    the new version of the new version of the new version of the new version of the
                                    new version
                                    of the new version of the new version of the </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first step is to be used in the first time . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first time of the year of the year . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first time of the world , the most important thing is that the world ' s
                                    largest economy , the world bank , the bank of england and the united states of
                                    america . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first time of the year of the year . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first time of the world is the most important thing is that the us is not
                                    the only
                                    way to get the best possible to use the " find in page " function below .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the guest reviews are submitted by our customers after their stay at hotel .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the main thing is that the most important thing is that we can ' t be able to do
                                    so . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the main thing is that the most important thing is that the us is not a good
                                    idea . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the guest reviews are submitted by our customers after their stay at hotel .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the the new version of the new version of the new version of the program .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city centre of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city , the hotel is a very good
                                    location . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first thing is that the company is not a single - party , which is the most
                                    important
                                    thing is that the most important thing is that the us is not a problem , but it
                                    is not a good idea . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the hotel is located in the heart of the city centre . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the guest reviews are submitted by our customers after their stay at hotel .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />


            <br>
            <p>

                这里我们遇到了另一个问题：样例缺乏多样性。你可能注意到了讨厌的<span class="data_text"><strong> "the hotel is located in the heart of
                        the city .</strong></span>
                _eos_" 这句话—感觉有一半的样例都生成了这句话！还要注意第一个例子中重复的短语<span class="data_text"><strong>"of the new
                        version"</strong></span>——效果不好的模型陷入了一个循环。

            </p>

            <p>总结一下我们的发现，使用温度可以改变采样质量，但一致性和多样性的其中之一会以牺牲另一者为代价受到影响。
            </p>


            <center>
                <img src="../resources/lectures/lang_models/sampling/temp_diversity_coherence-min.png"
                    style="max-width:70%; margin:10px;" />
            </center>

            <br><br>

            <h2 id="generation_strategies_top_k">Top-K 采样: 可能性最大的K个token <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Top%2DK%20sampling%3A%20top%20K%20most%20probable%20tokens"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h2>

            <p>改变温度很棘手：如果温度太低，那么几乎所有的token收到的概率都很低；如果温度过高，大量token（不是很好）将获得高概率。

            </p>
            <p>一个简单的启发式方法是始终从K个最有可能的token中采样：在这种情况下，模型仍然有一些选择性（K个token），但能够避免最不可能的token。
            </p>

            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u>
                        观察top-K采样在<strong>K=10</strong>时的结果。这些样例和标准方法采样得到的那些有何不同？试着描述它们的连贯性和多样性。

                        <br><br>
                        <font color="#888"><u>编者按</u>: we sample until the token is
                            generated.
                            我们采样直到生成句尾符 <strong>_eos_</strong> 。
                        </font>
                    </p>
                </div>


                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    it is possible to have fun in your heart . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first step of our work , we do not want to see the next level ? _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    we tried to make lyrics as correct as possible , however if you have any
                                    corrections for love me lyrics , please feel free to submit them to us .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the the following example : " i am a good thing i ' m going to be able to enjoy
                                    an amazing experience that you will be able to use the site to find the right to
                                    the right . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    for the unstable distribution of these products are used . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this would have been done in the past . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the guest reviews are submitted by our customers after their stay at the hotel .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this will help you make a reservation for your site and the staff at your
                                    disposal . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    a new approach is to create a new product , but it ' s a great success .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first one thing i would like to have a long time , but it is a great way of
                                    life is not very easy . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    it is a matter where you can find a wide variety of services . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first thing is that a man is made with a very high quality . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    if a new government will have to pay for more or more than 10 days , in the
                                    case of the company or to be the right to cancel your account . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the following are the result of the work of their own . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    we ' re - run in the course , it ' s a good idea . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the main goal of the project to create an environment to the extent to the
                                    extent possible . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    we tried to make lyrics as correct as possible , however if you have any
                                    corrections for i got a day lyrics , please feel free to submit them to us .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the guest reviews are submitted by our customers after their stay at hotel villa
                                    . </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first thing you need to be an independent from a company which
                                    is to be the main source of the state - the committee and its role of the world
                                    . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this page contains sub - categories and keyword pages or sub - categories that
                                    relate to your content ,
                                    you can suggest and create your own keyword pages listed here , the following
                                    the message was created
                                    by the fact that the government has failed to pay _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    for example , this is a good idea is not only a few years ago . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the first step is to develop a specific task force and the use of the
                                    " new version of the company , which the us are not to the same time of this
                                    year . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    if you do not want to see the next step - by - step instructions to - date .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the company has been the only way to create a unique position and the number of
                                    the most important things . _eos_ </p>
                            </div>
                        </center>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <br>


            <h3><u>固定的K并不总是好的
                </u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Fixed%20K%20is%20not%20always%20good"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>

            <p>虽然通常top-K采样比单独改变softmax温度更有效，但固定的K值肯定不是最优选择。请看下面的示意图。

            </p>

            <center>
                <img src="../resources/lectures/lang_models/sampling/topk_problems-min.png"
                    style="max-width:90%; margin:10px;" />
            </center>

            <p>top-K采样中固定的K值不好，因为top-K个最可能的token可能
            </p>
            <ul>
                <li>只覆盖总概率质量的很小部分（在较为平坦的分布中）；
                </li>
                <li>含有可能性非常小的tokens (在比较尖锐的分布中)。</li>
            </ul>

            <h2 id="generation_strategies_top_p">Top-p (亦称 Nucleus) 采样: 概率质量的前百分之p <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Top%2Dp%20(aka%20Nucleus)%20sampling%3A%20top%2Dp%25%20of%20the%20probability%20mass"
                    style="font-size:9px;" target="_blank">(英文原文)</a>
            </h2>

            <p>
                一个更合理的策略是考虑不是top k个最可能的token，而是覆盖概率质量的前p%的token：这个解决方案被称为<a href="https://arxiv.org/pdf/1904.09751.pdf"
                    target="_blank">核采样(Nucleus sampling)。</a>. </p>


            <p>请看下图：使用nucleus采样，我们采样的token数量是动态的，并且取决于分布的性质。
            </p>

            <center>
                <img src="../resources/lectures/lang_models/sampling/nucleus_example-min.png"
                    style="max-width:90%; margin:10px;" />
            </center>


            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">

                    <p class="data_text">
                        <u>如何观察：</u>
                        观察<strong>p=80%</strong>时nucleus采样的结果。比我们之前看到的其他所有的结果好吗?

                        <br><br>
                        <font color="#888"><u>编者按</u>: 我们采样直到生成句尾符 <strong>_eos_</strong>。

                        </font>
                    </p>
                </div>


                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    you ' re on - day to use a symbol of the « mystery » of ukrainian chamber choir
                                    . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    enjoy the international community for the term public safety is also a telephone
                                    to act or
                                    friends or send sms - mail message will be paid at special training for every
                                    moment ,
                                    it has also been kept upon its members and made , and to put it for young
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    here are always , and also check the information about the size of the material
                                    . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the staff were very friendly and helpful . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the third party runs when the us federal reserve the house of 300 pieces of raw
                                    materials in the game , by accident - and never - ending such clashes .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    there is a question of what people ' s go wrong , so it is hard to say that if
                                    he had never
                                    been well - known , the five times i noticed that the church would be pleased to
                                    announce
                                    that such sanctions should not be brought _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    and 2 , women and to work in other , but also with the interests of the republic
                                    of the open society . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the akvis sketch to address the following microsoft . com for the new york ...
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the company name comes as a developer ) and should be _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    you can also be interested in respect to the diversity of young - related , or
                                    is the time
                                    when you entered a luxury set , you can use a car of home - type ( i think that
                                    can ' t be very much of the process , i _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this has recently been saved as a change or else that is happening , and so far
                                    away . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this is not just to add a new interface ( 6 . 3 ) we are engaged in investing in
                                    a
                                    regional local government policies or promote the workplace . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    of the one color , since the user that is that it is why , in most cases there
                                    is no doubt that it would happen . _eos_ </p>
                            </div>
                        </center>
                    </div>


                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    here you can install the debian project installation . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    nevertheless , if you have any corrections for new lyrics , please feel free to
                                    submit them to us . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    i found that nothing exists for being - but also we can provide advice to at
                                    least up to 6 %
                                    growth of gdp by increasing economic prosperity . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the performance is that it is impossible to keep working on her professional
                                    career . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    we tried to make lyrics as correct as possible , however if you have any
                                    corrections for what want to say ? </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    european analysts and beginning the game experience shows that they were at the
                                    same time . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the fund had very little day on thursday , night and person on an individual
                                    soul in a clean and transparent manner . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    the parties responsible for their citizens and religious organizations .
                                    _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    ( 10 percent ) of the finnish and u . s . civil war . _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    this is why the government does not occur or any of any other terms and
                                    conditions
                                    for the people , and others remained still has to be more confident about which
                                    its way
                                    to the main challenge to find a company in “ corporate ” is complete with the
                                    case _eos_ </p>
                            </div>
                        </center>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <div style="width:80%; border: 0px solid #ccc;border-radius:5px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;">
                                <p style="padding:10px;font-family:courier">
                                    but in late 1980 , it ' s independence that comes from an empire place and
                                    occupied by all residents . _eos_ </p>
                            </div>
                        </center>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <br>


        </div>


        <br><br><br>

        <div id="evaluation">
            <h1>评估语言模型 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Evaluating%20Language%20Models"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h1>

            <div class="green_left_thought" style="font-size:18px;">
                <p class="data_text"><u>太长不看：</u> 当阅读一段新文本时，模型有多“惊讶”？
                </p>
            </div>


            <p>
                <a href="./word_embeddings.html#evaluation" target="_blank">正如我们在词嵌入教程中讨论的</a>,
                评价有两种类型：内在评价和外在评价。在这里我们讨论最常用的语言模型的内在评估。
            </p>

            <h2>当阅读一段新文本时，模型有多“惊讶”？ <a
                    href="https://lena-voita.github.io/nlp_course/seq2seq_and_attention.html#:~:text=Improve%20Subword%20Segmentation"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h2>

            <center>
                <img src="../resources/lectures/lang_models/evaluation/idea-min.png"
                    style="max-width:100%; margin:10px;" />
            </center>

            <p>
                就像好的物理世界模型必须与真实世界很好地吻合一样，好的语言模型也必须与<b>真实文本</b>很好地吻合。这是评估的主要思想：如果我们给一个模型的文本某种程度上接近模型所期望的，那么它就是一个好的模型。

            </p>

            <h2>交叉熵和困惑度 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Cross%2DEntropy%20and%20Perplexity"
                    style="font-size:9px;" target="_blank">(英文原文)</a>
            </h2>

            <p>
                但如何评估“文本是否与模型预期的内容接近”？在形式上，<b>模型必须将高概率分配给真实文本</b>（而将低概率分配给不太可能的文本）。
            </p>

            <h3><u>文本的交叉熵和对数似然</u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=Cross%2DEntropy%20and%20Log%2DLikelihood%20of%20a%20Text"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>
            <p>
                假设我们有一段留出的文本\(y_{1:M}= (y_1, y_2, \dots,
                y_M)\)。然后，语言模型分配给这段文本的概率代表了模型与文本“一致”的程度：即它能够根据上下文预测出现的token的程度：

            </p>
            <center>
                <img src="../resources/lectures/lang_models/evaluation/cross_entropy-min.png"
                    style="max-width:90%; margin:10px;" />
            </center>

            <p>
                这就是对数似然：与损失函数相同，但没有取负。还要注意对数底数：在优化中，通常采用自然对数（因为计算速度更快），但在评测中，对数是以2为底的。由于人们可能使用不同的底数，所以请说明你是如何计算结果：以bits（对数底数2）还是nats（自然对数）。

            </p>


            <h3><u>困惑度(Perplexity)</u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=nats%20(natural%20log).-,Perplexity,-Instead%20of%20cross"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>

            <p>

                不同于交叉熵，更常用的做法是计算它的变换形式，称之为 <b>困惑度</b>：
                \[Perplexity(y_{1:M})=2^{-\frac{1}{M}L(y_{1:M})}.\]
            </p>

            <p>一个更好的模型应该有更高的对数似然和更低的困惑度。
            </p>

            <p> 为了更好地理解我们能预期的困惑度取值，让我们计算一下 <b>最好</b>和 <b>最坏</b>的困惑度。</p>


            <ul>
                <li>困惑度<b>最好</b>为1
                    <br>
                    如果我们的模型是完美的，并且将概率1分配给文本中正确的token，那么对数概率为零，困惑度为1。


                </li>
                <li>困惑度<b>最差</b>为|V|
                    <br>
                    在最坏的情况下，语言模型对数据一无所知：不管上下文如何，它都认为所有token的概率都是\(\frac{1}{|V|}\)，那么

                    \[Perplexity(y_{1:M})=2^{-\frac{1}{M}L(y_{1:M})} =
                    2^{-\frac{1}{M}\sum\limits_{t=1}^M\log_2 p(y_t|y_{1:t-1})}=
                    2^{-\frac{1}{M}\cdot M \cdot \log_2\frac{1}{|V|}}=2^{\log_2 |V|} =|V|.\]
                </li>
            </ul>

            <p>因此，你得到的困惑度永远介于1和|V|之间。
            </p>


            <!-- <h2>Relation to Information Theory</h2> -->


        </div>


        <br><br>
        <div id="practical_tips">
            <h1>实用技巧 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#:~:text=1%20and%20%7CV%7C.-,Practical%20Tips,-Weight%20Tying%20(aka"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h1>

            <h2 id="weight_tying_trick">权重绑定(Weight Tying) (也称参数共享Parameter Sharing)
            </h2>

            <center>
                <img src="../resources/lectures/lang_models/practical/weight_tying_idea-min.png"
                    style="max-width:100%; margin:10px;" />
            </center>

            <p>请注意，在模型的实现中，必须定义两个嵌入矩阵：
            </p>
            <ul>
                <li>
                    <b>输入</b> —用于将上下文词输入网络，
                </li>
                <li>
                    <b>输出</b> —在softmax操作之前用于获取预测的输出。
                </li>
            </ul>
            <p>
                通常这两个矩阵是不同的（即，网络中的参数是不同的，它们不知道它们是相关的）。为了使用相同的矩阵，所有框架都有<b>权重绑定</b>
                的选项：它允许我们对不同的模块使用相同的参数。
            </p>

            <p><u>实用的观点</u>. 通常模型参数的很大一部分来自词嵌入—这些矩阵是十分巨大的！通过参数捆绑可以显著减小模型的大小。
            </p>

            <div class="card_with_ico">
                <img class="ico" width="40" src="../resources/lectures/ico/book_empty.png" />
                <div class="text_box_pink">
                    <p class="data_text">

                        权重绑定的效果类似于正则化项，可以迫使模型不仅对目标token，而且对嵌入空间中靠近接近的词的token也给出高概率。<a
                            href="#paper_weight_tying">更多细节请看这里。</a>
                    </p>
                </div>
            </div>


            <!--<h2 id="label_smoothing">Label Smoothing</h2>-->

        </div>


        <br><br><br>

        <div id="analysis_interpretability">
            <img height="40" src="../resources/lectures/ico/analysis_empty.png"
                style="float:left; padding-right:20px; " />
            <h1>分析与解释 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=details%20are%20here.-,Analysis%20and%20Interpretability,-Visualizing%20Neurons%3A%20Some"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h1>

            <h2>可视化神经元：有些是可解释的！ <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=Visualizing%20Neurons%3A%20Some%20are%20Interpretable!"
                    style="font-size:9px;" target="_blank">(英文原文)</a>
            </h2>

            <h3><u>经典佳作
                </u></h3>


            <p>
                观察神经语言模型中神经元激活值的（可能是）最著名的工作是Andrej Karpathy、Justin Johnson、Li Fei Fei的<a
                    href="https://arxiv.org/abs/1506.02078" target="_blank">Visualizing and Understanding Recurrent
                    Networks</a>。

            </p>

            <p>
                在这一工作中(以及其他类似工作)，作者训练了一个字符级的LSTM神经语言模型，并对神经元的激活值做了可视化。他们使用了两个截然不同的数据集：列夫·托尔斯泰的《战争与和平》小说——完全是英文文本，含有最少的标记，以及Linux内核的源代码。

            </p>


            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />
            <div class="box_green_left">

                <div class="text_box_green">
                    <p class="data_text">

                        请看<a href="https://arxiv.org/abs/1506.02078" target="_blank">Visualizing and Understanding
                            Recurrent Networks</a>一文中的例子。<br>
                        你认为模型为什么会倾向于这些内容？

                    </p>
                </div>

                <div class="carousel"
                    data-flickity='{ "imagesLoaded": true, "percentPosition": true, "wrapAround": true}'
                    style="width:100%; margin-top:10px; margin-bottom:30px; margin-left:10px;">
                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/position-min.png" />
                        </center>
                        <p style="text-align:center;">Cell sensitive to position in line</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/quotes-min.png" />
                        </center>
                        <p style="text-align:center;">Cell that turns on inside quotes</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/if-min.png" />
                        </center>
                        <p style="text-align:center;">Cell that activates inside if statements</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/comments_and_quotes-min.png" />
                        </center>
                        <p style="text-align:center;">Cell that turns on inside comments and quotes</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/depth-min.png" />
                        </center>
                        <p style="text-align:center;">Cell sensitive to the depth of an expression</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/new_line-min.png" />
                        </center>
                        <p style="text-align:center;">Cell that might be helpful in predicting new line</p>
                    </div>

                    <div class="carousel-cell" style="width:100%">
                        <center>
                            <img width="90%"
                                src="../resources/lectures/lang_models/analysis/karpathy_cells/not_interpretable-min.png" />
                        </center>
                        <p style="text-align:center;">Not easily interpretable cell (most of the cells)</p>
                    </div>

                </div>

            </div>
            <img height="20" src="../resources/lectures/ico/paw_empty.png" style="float:left; margin-top:-10px;" />


            <br><br>
            <h3><u>更近的工作: 情绪神经元
                </u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=More%20recent%3A%20Sentiment%20Neuron"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>

            <p>
                一个更近的有趣结果是Open-AI's的<a href="https://openai.com/blog/unsupervised-sentiment-neuron/"
                    target="_blank">情绪神经元(Sentiment Neuron)</a>。他们在8200万段亚马逊评论的语料库上，用乘法LSTM(multiplicative
                LSTM)训练了一个字符级语言模型。结果发现，模型学会了跟踪情绪！
            </p>

            <center>
                <img width="90%" style="margin-bottom:15px;"
                    src="../resources/lectures/lang_models/analysis/sentiment_neuron-min.png" />
            </center>

            <p>
                注意这一结果与前一个在性质上是不同的。在前面的例子中，神经元当然非常有趣，但它们与语言建模任务有着明显的联系：例如，预测下一个token需要追踪引号。在这里，情绪是一个更高层次的概念。在本课程的后面部分，我们将看到更多的例子，在这些例子中，语言模型在大规模训练数据集上学到了很多很酷的东西。

            </p>


            <h3><u>使用可解释的神经元来控制生成的文本</u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=Use%20Interpretable%20Neurons%20to%20Control%20Generated%20Texts"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>

            <p>
                可解释的神经元不仅有趣，还可以用来控制你的语言模型。例如，我们可以修改情绪神经元，以生成具有所需情绪的文本。下面是以相同前缀<font class="data_text"><strong>"I
                        couldn't figure out"</strong></font> 为开头生成的示例（更多示例见<a
                    href="https://openai.com/blog/unsupervised-sentiment-neuron/" target="_blank">original
                    Open-AI's的博文</a>）。
            </p>

            <img width="100%" style="margin-bottom:30px;"
                src="../resources/lectures/lang_models/analysis/sentiment_fixed-min.png" />


            <h3><u>那么CNN中的神经元（或卷积核）呢？
                </u> <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=What%20about%20neurons%20(or%20filters)%20in%20CNNs%3F"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h3>
            <div class="card_with_ico">
                <img class="ico" src="../resources/lectures/ico/bulb_empty.png" />
                <div class="text_box_yellow">
                    <p class="data_text">
                        在前面的教程中，我们研究了<a href="./text_classification.html#analysis_interpretability"
                            target="_blank">CNN卷积核（神经元）在训练文本分类时捕捉到的模式</a>。
                        直观地说，如果我们训练CNN进行语言建模，你认为CNN会捕获哪些模式？你可以在<a href="#research_thinking">研究思考</a>中的这一<a
                            href="#research_cnn_patterns">练习</a>检验你的直观猜想。

                    </p>
                </div>
            </div>


            <h2 id="analysis_contrastive">对比评价：测试特定的现象 <a
                    href="https://lena-voita.github.io/nlp_course/language_modeling.html#analysis_interpretability:~:text=Contrastive%20Evaluation%3A%20Test%20Specific%20Phenomena"
                    style="font-size:9px;" target="_blank">(英文原文)</a></h2>
            <p>为了测试你的LM是否知道一些非常具体的事情，你可以使用对比的测例。对比测例是几个相同文本的版本，它们只在你所关心的层面不同：一个正确，至少一个不正确。模型必须为正确的版本分配更高的分数（概率）。

            </p>
            <center>
                <img width="80%" style="margin-bottom:30px;"
                    src="../resources/lectures/lang_models/analysis/contrastive_idea-min.png" />
            </center>

            <p>
                一个非常受关注的现象是主谓一致性，最初是在<a href="https://www.aclweb.org/anthology/Q16-1037.pdf" target="_blank">
                    Assessing the Ability of LSTMs to Learn Syntax-Sensitive
                    Dependencies</a>一文中被提出。在这项任务中，对比测例由两个句子组成：一个是动词与主语数量一致的句子，另一个是动词相同但词形变化不正确的句子。

            </p>

            <img width="60%" style="margin-left:20px; margin-top:-20px; float:right;"
                src="../resources/lectures/lang_models/analysis/subject_verb-min.png" />

            <p>

                根据<b>吸引词</b>的数量，测例的复杂程度可能不同：句子中的其他具有不同的语法数量的名词，可以“分散”一个模型对主语的注意力。

            </p>
            <br>

            <div class="card_with_ico">
                <img class="ico" width="40" src="../resources/lectures/ico/book_empty.png" />
                <div class="text_box_pink">
                    <p class="data_text">
                        但我们如何知道模型是学到了语法还是仅仅学到了搭配/语义呢？使用一些没有意义的内容！<a href="#papers_analysis">更多细节</a>在这里。

                    </p>
                </div>
            </div>


        </div>

        <br><br><br>

        <div id="research_thinking">
            <img height="40" src="../resources/lectures/ico/bulb_empty.png"
                style="float:left; padding-right:10px; margin-top:-20px;" />
            <h1 style="margin-left:10px; margin-right:20px; float: left; margin-top:-20px">研究思考</h1>
            <hr color="#fced95" style="height:5px">
            <br><br>


            <fieldset style="border: 1px solid #f0e4a5;
    border-radius: 5px;">
                <legend>
                    <p class="data_text"><strong>怎么做？
                        </strong></p>
                </legend>
                <ul class="data_text">
                    <li>阅读开头的简短描述——这是我们的出发点，一些已知的内容。

                    </li>
                    <li>读一个问题并思考：一分钟，一天，或是一周，给自己一些时间！即使你不是一直在想这个问题，你仍然得到一些思考和启发。

                    </li>
                    <li>看看可能的答案——之前回答/解决这个问题的尝试。
                        <br>
                        <u>重要提示：</u>
                        你<strong>不应该</strong>提出和这里完全一样的东西—记住，每篇论文通常需要花费作者几个月的工作。思考这些事情是一种有用的习惯！科学家所需要的剩下的就是时间：用来不断地尝试-失败-思考，直到成功。

                    </li>
                </ul>

                <p class="data_text">众所周知，如果你不是马上得到答案，而是先思考一下，你会更容易学到东西。即使你不想成为一名研究人员，这仍然是一个学习的好方法！
                </p>
            </fieldset>

            <br><br>


            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <div class="research_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#786702">
                一点分析</h2>
            <div class="box_yellow_left">

                <!--##################################################-->
                <div class="researchCard" id="thumbnail_research">
                    <div class="researchIntro" id="research_cnn_patterns">

                        <div class="cardContent">

                            <div class="research_title">
                                CNN学到了什么模型？检验你的直觉

                            </div>

                            <hr color="#dedeca" style="margin:5px;">
                            <a href="./text_classification.html#analysis_interpretability"
                                target="_blank">正如我们在前面的教程中所看到的</a>，训练来进行情绪分析的CNN过滤器到了可解释且信息丰富的情感“线索”
                            （例如，<font class="data_text"><strong>poorly designed junk</strong></font>, <font
                                class="data_text"><strong>still working perfect</strong></font>, <font
                                class="data_text"><strong>a mediocre product</strong></font>等）。
                            当CNN被训练为语言模型时，你认为它捕捉到了什么？对语言模型来说，这些“信息丰富的线索”是什么？
                        </div>
                        <div>
                            <img width=90% src="../resources/lectures/lang_models/research/look_at_cnn_filter-min.png"
                                alt="" style="margin-top:20px;" class="center" />

                        </div>

                    </div>
                    <hr color="#dedeca" style="margin:5px">
                    <div class="cardContent">

                        <span class="research_question">?</span>
                        想象你在包含议会辩论和新闻评论的数据上训练了一个简单的CNN语言模型。你觉得你的模型可能捕捉到的模式会是什么样的？
                        <br>
                        <details>
                            <summary class="research_summary">
                                Possible answers
                            </summary>
                            <br>

                            <h2>太长不看: 模型学到了对手头任务有用的模式</h2>
                            <p>
                                让我们用一个简单的卷积模型来看看这篇<a href="https://www.aclweb.org/anthology/D16-1123.pdf"
                                    target="_blank">EMNLP
                                    2016</a>论文中的例子。与我们在前面的教程中中对文本分类模型所做的类似，作者将开发数集据输入给模型，并找到最能激活特定过滤器的n-grams。

                            </p>
                            <img width=100%
                                src="../resources/lectures/lang_models/research/learned_cnn_patterns-min.png" alt=""
                                style="margin-top:20px;margin-bottom:20px;" class="center" />
                            <p>
                                虽然用于情绪分类的模型学会了挑选与情绪相关的内容，但语言模型也捕获到了类似可以接续的短语。例如，一个核心在以月份结尾的短语上激活，另一个核心在以名字结尾的短语上激活；还要注意的是集中在
                                <font class="data_text"><strong>as ... as</strong></font>形式上的比较型核心。

                            </p>
                        </details>

                    </div>
                </div>

                <!--##################################################-->
            </div>
            <div class="research_circle" style="float:left;"></div>
            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <br><br>

            <div style="border: 0px solid #ccc;border-radius:15px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;margin-top:-20px;">
                <div style="display: grid; grid-template-columns: 75% 25%; margin:10px;">
                    <div>
                        <div style="margin-top:20px;">
                            <p style="margin:30px; font-size:30px;">这里会有更多的练习题</p>

                            <p style="margin:30px;">这一部分将不时地扩展。
                            </p>
                        </div>
                    </div>
                    <div>
                        <center>
                            <img src="../../resources/lectures/main/preview/pusheen_draws_on_white-min.png"
                                style="width:80%; padding-top:20px; padding-bottom:20px;border-radius:50%">
                        </center>
                    </div>
                </div>

            </div>

            <br><br>


        </div>

        <br><br><br>

        <div id="related_papers">
            <img height="40" src="../resources/lectures/ico/book_empty.png"
                style="float:left; padding-right:10px; margin-top:-20px;" />
            <h1 style="margin-left:10px; margin-right:20px; float: left; margin-top:-20px">相关论文</h1>
            <hr color="#facae9" style="height:5px">

            <br><br>

            <fieldset style="border: 1px solid #dec8d6;
    border-radius: 5px;">
                <legend>
                    <p class="data_text"><strong>如何阅读</strong></p>
                </legend>
                <ul class="data_text">
                    <li><u>概览速读</u>: 在简要总结中看一看关键结果—了解该领域的情况。

                    </li>
                    <li><u>更深入一些</u>: 对于你更感兴趣的主题，阅读包含图示和解释更长的摘要，浏览作者的推理步骤和关键观察结果。
                    </li>
                    <li><u>深度阅读</u>: 阅读你喜欢的论文。现在，当你理解了主要的想法，这会更容易！
                    </li>
                </ul>
            </fieldset>

            <br><br>


            <p class="data_text" style="font-size:24px;color:#7a3160">这部分的内容：</p>
            <ul class="data_text" style="font-size:20px;color:#7a3160">
                <li><a href="#papers_common_practice">普遍做法
                    </a></li>
                <li><a href="#papers_architectures">模型架构
                    </a></li>
                <li><a href="#papers_analysis">一些分析
                    </a></li>
                <li><a href="#papers_reading_behavior">语言模型与人类阅读行为
                    </a></li>
                <li><a href="#papers_smoothings">N-gram 语言模型: 更加平滑
                    </a></li>
                <li>... 待更新
                </li>
            </ul>


            <br><br>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <div class="paper_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#7a3160">
                普遍做法</h2>
            <div class="box_pink_left" id="papers_common_practice">


                <!--##################################################-->
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro" id="paper_weight_tying">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="https://arxiv.org/pdf/1611.01462.pdf" target="_blank" class="links">
                                    Tying Word Vectors and Word Classifiers: a Loss Framework for Language Modeling
                                </a>
                            </div>

                            <div class="paper_authors">
                                Hakan Inan, Khashayar Khosravi, Richard Socher
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">
                            <p>
                                讨论神经语言模型中权重绑定技巧的其中一篇论文：在输入和输出词嵌入层中使用相同的参数。理论上表明，这一做法效果类似于正则化器，该正则化器迫使模型对输入嵌入空间中接近的单词分配相似的概率。
                            </p>

                        </div>

                        <div>
                            <div class="conf_name">ICLR 2017</div>
                            <a href="https://arxiv.org/pdf/1611.01462.pdf" target="_blank">
                                <img width=100% src="../resources/lectures/lang_models/papers/weight_tying-min.png"
                                    alt="" style="margin-top:20px;" class="center" />
                            </a>
                        </div>

                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节</summary>

                            <h2>损失函数的想法：与目标相似的单词的概率较高
                            </h2>
                            <img width=90% src="../resources/lectures/lang_models/papers/similarity_loss_idea-min.png"
                                alt="" style="margin-top:20px;margin-bottom:20px;" class="center" />
                            <p>
                                标准损失函数是一个one-hot目标的交叉熵。这意味着在上面的例子中，我们将要求模型将概率1分配给token <span
                                    class="data_text"><strong>cat</strong></span>，其余的为0。然而，合理的做法是对与目标词语义相似的词赋予高概率。但是如何找到与当前目标相似的词，我们又应该分配什么概率呢？

                            </p>
                            <img width=40% src="../resources/lectures/lang_models/papers/weight_tying_emb_sim-min.png"
                                alt="" style="margin-left:20px; float:right;" class="center" />
                            <p>
                                为了评估目标词（即<span
                                    class="data_text"><strong>cat</strong></span>）与词汇表中其他词之间的相似性，我们可以使用输入的词嵌入。我们取目标词嵌入和其他所有词的嵌入的点积，并应用softmax得到概率分布。

                            </p>

                            <p>现在，我们可以在损失函数中添加一个新的项，以此鼓励模型将高概率分配给与目标相似的单词。

                            </p>
                            <img width=80%
                                src="../resources/lectures/lang_models/papers/weight_tying_total_loss-min.png" alt=""
                                style="margin-bottom:20px;" class="center" />


                            <h2>效果: 类似于权重绑定</h2>
                            <p>作者从理论上表明，优化带正则项的新的训练目标的效果类似于对输入和输出单词嵌入使用相同的参数（“权重绑定”）。
                            </p>

                            <h2>权重绑定的优点</h2>
                            <ul>
                                <li>
                                    <font face="arial">效果和收敛速度
                                    </font><br>
                                    实验表明，共享嵌入的模型具有更好的效果和更快的收敛速度。然而，这只适用于相对较小的数据集：使用较大的数据时，这一结论可能不再成立。
                                </li>
                                <li>
                                    <font face="arial">更小的模型
                                    </font><br>
                                    由于嵌入层有很多参数（嵌入维度*|V |），权重绑定可以显著减少模型尺寸（例如，减少25-30%；当然，这取决于模型和词表的大小）。

                                </li>
                            </ul>

                        </details>
                    </div>
                </div>


            </div>
            <div class="paper_circle" style="float:left;"></div>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->


            <br><br>
            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <div class="paper_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#7a3160">
                模型架构</h2>
            <div class="box_pink_left" id="papers_architectures">

                <!--##################################################-->
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="https://arxiv.org/pdf/1612.08083.pdf" target="_blank" class="links">
                                    Language Modeling with Gated Convolutional Networks
                                </a>
                            </div>

                            <div class="paper_authors">
                                Yann N. Dauphin, Angela Fan, Michael Auli, David Grangier
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">

                            不同于普遍的看法，作者们指出，无限长度的上文对好的语言模型来说并不是必需的。他们提出了一种具有叠加卷积和新的门控机制的模型，即<font face="arial">
                                门控线性单元（GLU）</font>。因为卷积很容易在词上并行化，所以这个模型的训练比LSTM快得多。


                        </div>

                        <div>
                            <div class="conf_name">ICML, 2017</div>
                            <a href="https://arxiv.org/pdf/1612.08083.pdf" target="_blank">
                                <img src="../resources/lectures/lang_models/papers/glu_paper-min.png" alt=""
                                    style="margin-top:20px;" class="center" />
                            </a>
                        </div>

                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节</summary>
                            <br>
                            <h2>门控线性单元</h2>
                            <p>
                                不同于简单的卷积，该文引入了<b>门控线性单元</b>，这种单元变得非常流行。这个想法类似于LSTM，但不是从左到右，而是从下到上。

                            </p>
                            <img src="../resources/lectures/lang_models/papers/glu_paper-min.png" alt="" width=40%
                                style="margin-left:20px;float:right;" />
                            <p>
                                除了提取特征并将其传递到下一层之外，还需要了解对这一token我们需要传递哪些特征需要，哪些不需要。为此，卷积用来提取\(2d\) 维的特征：
                            </p>
                            <ul>
                                <li>\(d\) <b>维内容特征</b><br>
                                    这是主要特征—用于从输入中抽取信息。
                                </li>
                                <li>\(d\) <b>维门控特征</b><br>
                                    门控特征用于屏蔽内容特征。它们被传递给sigmoid函数，将特征转换为从0到1的“门值”。

                                </li>
                            </ul>

                            <img src="../resources/lectures/lang_models/papers/glu_model-min.png" alt="" width=50%
                                style="margin-left:20px;float:right;" />
                            <h2>模型架构</h2>
                            <p>
                                模型架构如图所示。它由几个模块组成，包含由残差模块包裹的一个（或几个）GLU层。该文尝试了不同的模型结构：1-6个卷积核，不同层数和滤波器。
                            </p>


                            <h2>质量和上下文大小</h2>
                            <p>
                                下图显示了模型质量依赖于上下文大小（上下文大小是CNN的感受野；评估和我们在这部分的一样）。总而言之，如果你堆叠的层数足以覆盖约40个token，那你的模型就相当不错了。


                            </p>
                            <img src="../resources/lectures/lang_models/papers/glu_context_size-min.png" alt=""
                                width=100% style="margin-top:20px;margin-bottom:20px;float:right;" />
                            <p>请注意，虽然n-gram和卷积模型都有固定的上下文大小，但这只会给n-gram模型带来问题：它们无法具备长上下文。相比之下，使用若干个卷积层，您确实能够处理长上下文。
                            </p>

                            <h2>论文里的更多内容
                            </h2>
                            <ul>

                                <li>该模型优于被比较的LSTM；
                                </li>
                                <li>该模型的训练速度比LSTM快得多。

                                </li>
                            </ul>


                            更多细节请阅读<a href="https://arxiv.org/pdf/1612.08083.pdf" target="_blank" 原论文</a>！

                        </details>
                    </div>
                </div>

                <!--##################################################-->


            </div>


            <!--##################################################-->

            <div class="cardContent">
                <a href="#analysis_contrastive"></a>
            </div>


            <!--##################################################-->




            <div class="paper_circle" style="float:left;"></div>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <br><br>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->


            <!-- </div>
    </div> -->

            <div class="paper_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#7a3160">
                一些分析
            </h2>
            <div class="box_pink_left" id="papers_analysis">

                <!--##################################################-->
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="https://www.aclweb.org/anthology/N18-1108.pdf" target="_blank" class="links">
                                    Colorless green recurrent networks dream hierarchically
                                </a>
                            </div>

                            <div class="paper_authors">
                                Kristina Gulordava, Piotr Bojanowski, Edouard Grave, Tal Linzen, Marco Baroni
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">

                            <a href="#analysis_contrastive">如前我们前面看到的</a>，对比评估可用于检查一个模型是否符合语法，例如通过测试主谓一致性。
                            但我们怎么知道模型是学习了语法还是仅仅学习了搭配/语义呢？作者提出了一个非常有趣的方法来找出答案：让我们用一个没有意义的句子，来看看模型是否产生了正确的屈折变化。


                        </div>

                        <div>
                            <div class="conf_name">NAACL, 2018</div>
                            <a href="https://www.aclweb.org/anthology/N18-1108.pdf" target="_blank">
                                <img src="../resources/lectures/lang_models/papers/gulordava_paper-min.png" alt=""
                                    style="margin-top:20px;" class="center" />
                            </a>
                        </div>


                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节</summary>
                            <br>
                            <h2>无意义如何帮助你的研究</h2>
                            <p>

                                为了区分一个模型确实学会了语法一致或只是搭配的情况，作者不仅测试了“正常”的例子，还测试了那些没有意义的例子。
                                例如，在句子<font class="data_text"><strong>“The colorless green <font color="#79a123">
                                            ideas
                                        </font>
                                        I ate with the chair <font color="#79a123">sleep</font> furiously
                                        ?”</strong>
                                </font>中，模型是否能预测正确的一致性？

                            </p>
                            <p>作者们生成了这样的例子：他们使用一个原始句子，用随机词汇替换掉一些词，但保留词性和词形变化。上面展示的就是一个例子。

                            </p>

                            <p>
                                看一下结果("5-gram KN" 是使用 <a href="#papers_smoothings">Kneser-Ney平滑</a>的5-gram模型).
                            </p>

                            <img src="../resources/lectures/lang_models/papers/gulordava_results-min.png" alt=""
                                width=100% style="margin-top:20px;margin-bottom:20px;float:right;" />

                            <p>上述结果表明:</p>
                            <ul>
                                <li>
                                    <b>对n-gram模型, 上下文没有帮助</b><br>
                                    对于无意义的句子，5-gram模型并不比unigram模型好。不过对于普通的句子来说要好一点。
                                </li>
                                <li>
                                    <font face="arial">对相同的上下文, LSTM比n-gram模型好很多
                                    </font><br>

                                    对于原本的和修改过的测例，差异巨大。这就是神经网络的力量—它们“知道”哪些词是相似的，而n-gram模型只依赖于共现。<br>
                                    大小不是唯一重要的！神经模型之所以更好，不仅因为上下文的大小，还因为它们处理上下文的方式。
                                </li>
                                <li>
                                    <b>对LSTM, 长的上下文确实有帮助</b><br>
                                    对LSTM, 长的上下文确实有帮助
                                    这很好—这意味着LSTM确实使用了长上下文。还要注意的是，即使是修改过的句子，分数也相当高！

                                </li>
                            </ul>

                            <h2>论文里的更多内容</h2>
                            <ul>

                                <li>生成无意义测例的详细过程;
                                </li>
                                <li>对特定语法结构的结果和讨论。
                                </li>
                            </ul>

                            更多细节请阅读<a href="https://www.aclweb.org/anthology/N18-1108.pdf" target="_blank">原论文</a>！


                        </details>
                    </div>
                </div>

                <!-- </div> -->

                <!--##################################################-->


            </div>
            <div class="paper_circle" style="float:left;"></div>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->


            <br><br>
            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <div class="paper_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#7a3160">
                语言模型和人类阅读行为
            </h2>
            <div class="box_pink_left" id="papers_reading_behavior">
                <br><br>
                <p class="data_text" style="margin-top:-20px">
                    <font color="#888">
                        <u>编者按</u>: 这不是语言建模教程的“相关论文”列表中的典型内容（至少，我从未在任何一个教程中看到过）。但当我第一次发现这篇论文的时候，我太激动了，忍不住想和你们分享了。

                    </font>
                </p>

                <!--##################################################-->
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3709001/pdf/nihms-455892.pdf"
                                    target="_blank" class="links">
                                    The effect of word predictability on reading time is logarithmic
                                </a>
                            </div>

                            <div class="paper_authors">
                                Nathaniel J. Smith and Roger Levy
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">
                            人类阅读一个单词所需的时间可以通过估计该单词在上下文中的概率估计来预测。本文表明：（i）n-gram语言模型中的概率P（单词|上下文）是这一时间的很好的预测因子；（ii）单词的对数概率和阅读时间之间是（近）线性的（如右图）。


                        </div>

                        <div>
                            <div class="conf_name">Cognition, 2013</div>
                            <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3709001/pdf/nihms-455892.pdf"
                                target="_blank">
                                <img src="../resources/lectures/lang_models/papers/reading_slowdown-min.png" alt=""
                                    style="margin-top:20px;" class="center" />
                            </a>
                        </div>

                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节</summary>

                            <h2>阅读时间与单词在上下文中的可预测性</h2>

                            <p>
                                当我们阅读一段文本时，阅读每个单词所花的时间与我们对这个单词的预期有关：一个单词的“期望性”越高，我们阅读它所需的时间就越少。然而，人类的每词处理时间与给定上下文是单词的“可预测性”之间的确切函数关系尚且是未知的。

                            </p>

                            <p>本文的重点是，语言模型可以用来估计给定上下文时单词的“可预测性”。
                            </p>

                            <h2>可计算的语言模型而非人类的语言模型——一个新颖的想法</h2>

                            <p>在此之前，给定上下文时一个单词的可预测性是通过完形填空任务评估的。例如，续写下面的句子：

                            </p>

                            <p class="data_text" style="margin-left: 30px;">
                                (1) My brother came inside to...<br>
                                (2) The children went outside to...
                            </p>
                            <p>
                                在第一个例子中,后续部分可能非常不同，但在第二个例子中，大约90%的参与者都建议<font class="data_text">
                                    <strong>play</strong>
                                </font>这个词。

                            </p>

                            <p>
                                没有数据。这就是为什么使用<b>可计算</b>的语言模型而不是人类语言模型的想法是如此具有开创性：<font face="arial">
                                    它允许非常容易地估计单词的可预测性</font>。


                            </p>


                            <h2>研究的组成部分</h2>
                            <p>
                                <font face="arial">与人类行为有关的数据:
                                </font>
                            </p>
                            <ul>
                                <li>
                                    <b>眼动追踪eye-tracking</b><br>
                                    母语者阅读新闻报纸文本时的眼球移动
                                </li>
                                <li>
                                    <font face="arial">自我调速阅读
                                    </font><br>
                                    移动窗口以自我调整阅读时间：参与者必须按一个按钮来依次显示每个单词。记录的数据：按键之间的间隔时间。

                                </li>
                            </ul>

                            <p>
                                <b>语言模型: </b>3-gram带Kneser-Ney平滑.
                            </p>


                            <img src="../resources/lectures/lang_models/papers/reading_slowdown2-min.png" alt=""
                                width=30% style="margin-top:20px;margin-left:20px;float:right;" />
                            <h2>结果</h2>
                            <ul>
                                <li>可计算语言模型可以很好地预测人类阅读每个单词所需的时间;

                                </li>
                                <li>阅读时间和可预测性之间的函数关系现在知道了：对数关系（即，单词的对数概率和阅读时间之间的关系是（近）线性的——如右图所示）。

                                </li>
                            </ul>

                            当然，<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3709001/pdf/nihms-455892.pdf"
                                target="_blank">原论文</a>中有多得多的细节！


                        </details>
                    </div>
                </div>

                <!--##################################################-->


                <!--##################################################-->
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="https://arxiv.org/pdf/2006.01912.pdf" target="_blank" class="links">
                                    On the Predictive Power of Neural Language Models for Human Real-Time
                                    Comprehension Behavior
                                </a>

                            </div>

                            <div class="paper_authors">
                                Ethan G. Wilcox, Jon Gauthier, Jennifer Hu, Peng Qian, Roger P. Levy
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">
                            根据之前的工作，探索哪些语言模型（不同的架构和数据集）更能预测人类行为。总的来说，传统的语言模型的困惑度是一个很好的估计。奇怪的是，Transformer（我们将在下一个教程中讨论）和n-gram语言模型比LSTM更好。

                        </div>

                        <div>
                            <div class="conf_name">2020</div>
                            <a href="https://arxiv.org/pdf/2006.01912.pdf" target="_blank">
                                <img src="../resources/lectures/lang_models/papers/reading_slowdown_across_models-min.png"
                                    width=90% alt="" style="margin-top:20px;" class="center" />
                            </a>
                        </div>

                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节
                            </summary>
                            <h3>考虑的模型</h3>
                            <ul>
                                <li>
                                    <b>5-gram</b>: 带 Kneser-Ney平滑的5-gram语言模型;
                                </li>
                                <li>
                                    <b>LSTM</b>: 标准的LSTM;
                                </li>
                                <li>
                                    <b>RNNG</b>: 建模一个单词序列和对应句法结构的联合概率;

                                </li>
                                <li>
                                    <b>GPT-2</b>: Transformer 语言模型. 一个非常受欢迎的模型，我们在随后和课程中会见到。

                                </li>
                            </ul>

                            <h2>语言模型惊讶 vs 阅读时间</h2>
                            <img src="../resources/lectures/lang_models/papers/reading_slowdown_across_models2-min.png"
                                width=50% alt="" style="margin-left:20px; float: right;" />
                            <p>右图显示了在不同模型结构和语料上，语言模型“惊讶”（负对数概率）与人类阅读时间之间的关系（更多信息见原论文！）。主要观察结果如下：</p>
                            <ul>
                                <li>对所以模型来说，这一关系都是<b>线性的</b>；</li>
                                <li>人类阅读时间，对于LSTM的预测，其方差高于对于其他模型的预测。

                                </li>
                            </ul>

                            <h2>心理测量学的预测能力vs语言模型困惑度P

                            </h2>
                            <img src="../resources/lectures/lang_models/papers/perplexity_vs_predictive_power-min.png"
                                width=50% alt="" style="margin-left:20px; float: right;" />

                            <p>

                                (“心理测量学的预测能力”这一可怕的短语只是指语言模型在预测人类行为方面有多好。)

                            </p>

                            <p>一般来说，我们看到困惑度较低的模型（在NLP中，我们认为是好模型）也能很好地预测人类行为。
                            </p>


                        </details>
                    </div>
                </div>

                <!--##################################################-->

            </div>
            <div class="paper_circle" style="float:left;"></div>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->


            <br><br>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->

            <div class="paper_circle" style="float:left;"></div>
            <h2 style="margin-top:-10px; float: left; padding-left:10px; padding-right:10px; color:#7a3160">
                N-gram 语言模型: 更多平滑
            </h2>
            <div class="box_pink_left" id="papers_smoothings">
                <br><br>
                <!--
        <p class="data_text" style="margin-top:-20px"><font color="#888">
            <u>Lena</u>: to be honest, I doubt you will need this -
        n-gram language models are not widely used. A quick look at other ML for NLP courses
            showed that this part is omitted in most of them.
        I hope, however, that some of you may be interested in this.
            All in all, this is part of our history I'm not yet ready to throw away :)</font></p>
        -->


                <!--##################################################-->
                <!--
            <div class="paperCard" id="thumbnail_paper" >
            <div class="paperIntro">

              <div class="cardContent">

                  <div class="paper_title">
                      <a href="" target="_blank" class="links">
                      Goog-Turing Smoothing
                      </a>
                  </div>

                <div class="paper_authors">
                    ???, ???
                </div>
                <hr color="#f2e4ee" style="margin:5px;">

              </div>

                <div>
                    <div class="conf_name">???</div>
                  <a href="" target="_blank">
                      <img src="../resources/lectures/word_emb/papers/???-min.png"
                           alt="" style="margin-top:20px;" class="center"/>
                  </a>
                </div>

             </div>
            <hr color="#f2e4ee" style="margin:5px">
            <div class="cardContent">
                <details>
                    <summary style="margin-left:10px;">More details</summary>



                </details>
            </div>
        </div>
          -->

                <!--##################################################-->


                <!--##################################################-->
                <h3 style="color:#7a3160"> Kneser-Ney 平滑</h3>
                <div class="paperCard" id="thumbnail_paper">
                    <div class="paperIntro">

                        <div class="cardContent">

                            <div class="paper_title">
                                <a href="http://www-i6.informatik.rwth-aachen.de/publications/download/951/Kneser-ICASSP-1995.pdf"
                                    target="_blank" class="links">
                                    Improved backing-off for M-gram language modeling
                                </a>

                            </div>

                            <div class="paper_authors">
                                Reinhard Kneser, Hermann Ney
                            </div>
                            <hr color="#f2e4ee" style="margin:5px;">
                            <p>
                                简单的回退平滑会丢弃上下文，并在
                                k < n 时从n-gram回退到k-gram。 但让我们以短语为例<font class="data_text"><strong>San
                                        Francisco</strong></font>：这个短语常见，所以<font class="data_text">
                                        <strong>Francisco</strong>
                                    </font>将有很高的unigram概率。
                                    那么问题来了：<font class="data_text"><strong>Francisco</strong></font>主要是出现在<font
                                        class="data_text"><strong>San</strong></font>之后，但是当使用回退平滑时，
                                    它很大的unigram概率将导致<font class="data_text"><strong>Francisco</strong></font>
                                    接在任何token之后的概率都很大！

                            </p>


                        </div>

                        <div>
                            <div class="conf_name">ICASSP 1995</div>
                            <a href="http://www-i6.informatik.rwth-aachen.de/publications/download/951/Kneser-ICASSP-1995.pdf"
                                target="_blank">
                                <img width=80% src="../resources/lectures/lang_models/papers/san_francisco-min.png"
                                    alt="" style="margin-top:20px;" class="center" />
                            </a>
                        </div>

                    </div>
                    <hr color="#f2e4ee" style="margin:5px">
                    <div class="cardContent">
                        <details>
                            <summary style="margin-left:10px;">更多细节</summary>
                            <br>

                            <h2>Unigram 概率: 愚蠢回退 vs Kneser-Ney平滑</h2>
                            <p>
                                在看完整的Kneser-Ney公式之前，我们首先比较一下，使用Kneser-Ney和愚蠢回退平滑的单个token的概率。
                                愚蠢回退基于简单的unigram计数\(N(w_i)\)：\(w_i\)在语料库中出现的次数。
                                正如我们前面提到的，这对于像<font class="data_text"><strong>San
                                        Francisco</strong></font>这样的例子来说是行不通的。

                            </p>

                            <center>
                                <img width=80% src="../resources/lectures/lang_models/papers/stupid_vs_kneser-min.png"
                                    alt="" style="margin:20px;" />
                            </center>

                            <p>
                                与简单回退不同，Kneser
                                Ney平滑使用的不是原始的计数，而是\(w_i\)可以接在后面的token的数量。直观上这正是我们想要的：我们需要一些信息来告诉我们\(w_i\)接在一个前缀后的可能性有多大。在我们的例子中，
                                <font class="data_text"><strong>
                                        Francisco</strong></font>的概率很低（正如它应该是的那样）。

                            </p>

                            <h2>更进一步：迭代公式</h2>
                            <p>对完整的公式，我们需要再定义一个计数：
                            </p>
                            <center>
                                <img width=100% src="../resources/lectures/lang_models/papers/kn_words_follow-min.png"
                                    alt="" style="margin-bottom:20px;" />
                            </center>

                            <p>Kneser-Ney完整的回退公式如下所示：
                            </p>
                            <img width=100% src="../resources/lectures/lang_models/papers/kneser_ney_formula2-min.png"
                                alt="" style="margin-top:20px;" />
                        </details>
                    </div>
                </div>

                <!--##################################################-->

            </div>
            <div class="paper_circle" style="float:left;"></div>

            <!--##################################################-->
            <!--##################################################-->
            <!--##################################################-->


            <br><br>
            <div style="border: 0px solid #ccc;border-radius:15px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;margin-top:-20px;">
                <div style="display: grid; grid-template-columns: 75% 25%; margin:10px;">
                    <div>
                        <div style="margin-top:20px;">
                            <p style="margin:30px; font-size:30px;">这儿会有更多论文！</p>

                            <p style="margin:30px;">论文会逐渐更新出现.</p>
                        </div>
                    </div>
                    <div>
                        <center>
                            <img src="../../resources/lectures/main/preview/pusheen_reads_on_white-min.png"
                                style="width:80%; padding-top:20px; padding-bottom:20px;border-radius:50%">
                        </center>
                    </div>
                </div>

            </div>
        </div>

    </div>


    <br><br><br>
    <div id="have_fun">
        <img height="40" src="../resources/lectures/ico/fun_empty.png"
            style="float:left; padding-right:10px; margin-top:-20px;" />
        <h1 style="margin-left:10px; margin-right:20px; float: left; margin-top:-20px">Have Fun!</h1>
        <hr color="#c8edfa" style="height:5px">
        <br><br>

        <!--
    <div style="border: 0px solid #ccc;border-radius:15px;margin: 10px; padding: 4px;
 background-color: #f5f5f5;margin-top:-20px;">
    <div style="display: grid; grid-template-columns: 75% 25%; margin:10px;">
                <div>
                <div style="margin-top:20px;">
                    <p style="margin:30px; font-size:30px;">Coming soon!</p>

                    <p style="margin:30px;">We are still working on this!</p>
                </div>
                    </div>
                <div>
                    <center>
                    <img src="../../resources/lectures/main/preview/typing.gif"
                       style="width:80%; padding-top:20px; padding-bottom:20px;border-radius:50%">
                    </center>
                </div>
            </div>
    </div>
-->


        <fieldset style="border: 1px solid #008cbf;
    border-radius: 5px;font-size:18px;">
            <legend>
                <p class="data_text" style="font-size:24px;">
                    <font color="#008cbf"><strong>Bla Bla Bla</strong></font>
                </p>
            </legend>
            <p class="data_text">
                通常，我们希望像词嵌入能像人类一样推理。但我们可以试试相反的思路：试着像词嵌入一样思考。


            </p>
            <p class="data_text">
                你会看到类似的例子，例如<strong>king - man + woman = ?</strong>，还有几个可能的答案。任务是猜测词嵌入会怎么想。
            </p>

            <p></p>

            <p class="data_text" style="font-size:14px;">
                <font color="#888">Big thanks
                    <a href="https://github.com/justheuristic">Just Heuristic</a> for the help with technical
                    issues! Just Heuristic - Just Fun!
                </font>
            </p>
        </fieldset>

        <br><br>


        <center>
            <div class="lm_window" id="lm_window" style="width: 100%;">
                <div class="cardContent">
                    <p class="prompt_text">Let's write a paper!</p>
                    <p class="comment_text" style="font-size:18px;">
                        Every great paper starts with an inciting thought - something only a human can have ...<br>
                    </p>
                    <hr color="#e9f0f2" style="margin:5px; display: block">
                    <div id="lm_prompt_screen" style="display: block">
                        <div class="prompt_and_button" style="margin-top: 0px;">
                            <div style="width: 85%; margin-left: 7%;">
                                <p class="data_text"
                                    style="font-size: 16px; color: gray; text-align:left; margin-bottom: -2px;">
                                    Write a prefix, for example: "Deep Variational" (without quotes)</p>
                                <textarea class="input_prompt" style="width: 100%; max-width: 100%; min-height: 72px;
                                         resize: vertical; font-size:14px;"></textarea>
                            </div>
                            <div class="next" style="opacity:0.2; transform: translate(-32px, 35px);">
                                <div class="next_button"></div>
                                <p class="next_text">Start!</p>
                            </div>
                        </div>

                        <p class="comment_text status_comment" id="aftertext_jk" style="color:gray; font-size: 16px">
                            Waiting for the model to load... (this should take 3-5s)
                        </p>
                    </div>


                    <div id="lm_generate_screen" style="display: none">
                        <div style="width: 85%; margin-left: 7%; float: center; display: block">
                            <p class="data_text"
                                style="font-size: 16px; color: gray; text-align:left; margin-bottom: -2px; margin-left: 5px;">
                                Currently generated text ("@@" is a BPE split). Click on the circles below to add
                                tokens.</p>
                            <textarea class="input_preprocessed"
                                style="width: 100%; resize: vertical; margin-left: 5px; font-size:14px;"
                                disabled=true></textarea>
                        </div>
                        <div id="d3_container" style="width: 85%; display:block; margin: 0 auto;">
                            <svg id="d3_beamsearch_svg" width=100% height=240px></svg>
                        </div>
                        <button class="rect_button button_add_greedy"
                            onclick="console.warn('generate button should not be available at this point')">
                            <p class="button_text" style="font-size:16px">Add greedy</p>
                        </button>
                        <button class="rect_button button_backspace"
                            onclick="console.warn('backspace button should not be available at this point')">
                            <p class="button_text" style="font-size:16px">Backspace</p>
                        </button>
                        <button class="rect_button button_restart"
                            onclick="console.warn('restart button should not be available at this point')">
                            <p class="button_text" style="font-size:16px">Restart</p>
                        </button>
                    </div>
                </div>
            </div>
        </center>

        <script> // this script ONLY defines global constants
            var beam_size = 4;
            var search_length = 5;
        </script>

        <script> // this <script> defines model, vocabularies & auxiliary functions, NOT the interface
            var model, lstm_units, emb_size, voc_size, bpe_rules, vocab, bos, eos, unk,
                token_to_ix = {}, bpe_rule_priority = {}, is_initialized = false;  // to be initialized
            let tokenizer_regex = new RegExp(/([A-zÀ-ÿ-]+|[0-9._]+|.|!|\?|'|"|:|;|,|-)/i);
            let bpe_terminal = "</w>", bpe_sep = "@@";

            async function async_initialize_model() {
                console.assert(!is_initialized, "Model was initialized more than once!")
                model = await tf.loadLayersModel('../resources/lectures/lang_models/fun/lm/model.json');
                voc_response = await fetch('../resources/lectures/lang_models/fun/voc.json');
                [lstm_units, emb_size, voc_size, bpe_rules, vocab, bos, eos, unk] = await voc_response.json();
                vocab.forEach((token, index) => token_to_ix[token] = index);
                bpe_rules.forEach((pair, index) => bpe_rule_priority[pair[0] + " " + pair[1]] = index);
                is_initialized = true;
            }

            function preprocess(string) {
                // raw string -> array of tokens -> array of bpe segments
                console.assert(is_initialized, "Model is not initialized!")
                return tokenize(string).flatMap(bpeize_token)
            }

            function tokenize(string) {
                let tokens = [];
                string.split(tokenizer_regex)
                    .filter(token => (token != ' ' && token != '' && token != '\n'))
                    .forEach(token => tokens.push(token.toLowerCase()))
                return tokens
            }

            function bpeize_token(token) {
                // split a single token into an Array of bpe segments; equivalent to https://github.com/rsennrich/subword-nmt v0.2
                let segments = token.split('');
                segments[segments.length - 1] += bpe_terminal;

                while (segments.length > 1) {
                    // find bpe rule with lowest index
                    var best_rule_index = Infinity;
                    for (let i = 0; i < segments.length - 1; i++) {
                        let cand = segments[i] + " " + segments[i + 1];
                        if ((cand in bpe_rule_priority) && (bpe_rule_priority[cand] < best_rule_index))
                            best_rule_index = bpe_rule_priority[cand];
                    }
                    if (best_rule_index == Infinity)
                        break
                    // apply that rule everywhere
                    let [chosen_left, chosen_right] = bpe_rules[best_rule_index];
                    for (let i = segments.length - 2; i >= 0; i--) {
                        if (segments[i] == chosen_left && segments[i + 1] == chosen_right) {
                            segments.splice(i + 1, 1);
                            segments[i] = chosen_left + chosen_right;
                        }
                    }

                }
                // don't print </w> symbols
                end = segments.length - 1
                if (segments[end] == bpe_terminal)
                    segments.pop()
                else if (segments[end].endsWith(bpe_terminal))
                    segments[end] = segments[end].slice(0, segments[end].length - bpe_terminal.length);

                // append bpe separator to all segments except last
                for (let i = 0; i < segments.length - 1; i++)
                    segments[i] += bpe_sep;

                return segments
            }

            function get_initial_state() {
                console.assert(is_initialized, "Model is not initialized!")
                return [tf.zeros([1, voc_size]), tf.zeros([1, lstm_units]), tf.zeros([1, lstm_units])]
            }

            function generate_beam_search_vertices(prev_state) {
                // runs beam search with up to beam_size hypotheses for search_length steps
                // updates bokeh data source (and hence, the data shown in bokeh
                var [prev_logits, prev_hid, prev_cell] = prev_state;
                var plot_data = [
                    {
                        x: 0.0, y: 0.0, token_text: "<...>", circle_text: "#1",
                        edge: [{ x: -0.5, y: 0.0 }, { x: 0, y: 0 }], parent_index: -1
                    },
                ]
                var parent_i = 0;
                for (let t = 0; t < search_length; t++) {

                    var token_ix = prev_logits.argMax(-1);

                    var best_token_indices = findIndicesOfMax(prev_logits.arraySync()[0], beam_size)
                    for (let i = 0; i < best_token_indices.length; i++) {
                        var token = vocab[best_token_indices[i]];
                        plot_data.push({
                            x: t + 1, y: 1.5 * i, token_text: token, circle_text: `#${i + 1}`,
                            edge: [{ x: plot_data[parent_i].x, y: plot_data[parent_i].y },
                            { x: t + 1, y: 1.5 * i }], // add edge from parent to oneself
                            parent_index: parent_i,
                        })
                    }

                    [prev_logits, prev_hid, prev_cell] = model.predict([token_ix.reshape([1, -1]), prev_hid, prev_cell]);
                    parent_i = plot_data.length - beam_size;
                }
                return plot_data;
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function findIndicesOfMax(inp, count) {
                var outp = [];
                for (var i = 0; i < inp.length; i++) {
                    outp.push(i); // add index to output array
                    if (outp.length > count) {
                        outp.sort(function (a, b) {
                            return inp[b] - inp[a];
                        }); // descending sort the output array
                        outp.pop(); // remove the last index (index of smallest element in output array)
                    }
                }
                return outp;
            }

        </script>

        <script> // this script ONLY draws d3js charts and nothing else
            var svg = d3.select("#d3_beamsearch_svg");
            var d3_div = document.getElementById('d3_container');
            var x_scale, y_scale, circle_containers, beam_search_ready = false;
            var example_plot_data = [{
                x: 0.0, y: 0.0, token_text: "<...>", circle_text: "#1",
                edge: [{ x: -0.5, y: 0.5 }, { x: 0, y: 0 }], parent_index: -1
            },
            ]; // this is an example, the actual data will be filled in by generate_beam_search_vertices
            var circle_attrs = { r: 12, fill: "#87CEEB", stroke: "navy", "stroke-width": 1.5 };
            var line_attrs = {
                fill: "none", stroke: "black", "stroke-width": 1.0,
                d: (function (plot_data_elem) {
                    return d3.svg.line()
                        .x(function (d_i) {
                            return x_scale(d_i.x);
                        })
                        .y(function (d_i) {
                            return y_scale(d_i.y);
                        })
                        (plot_data_elem.edge)
                })
            };

            // TODO features: change line width if is_best, change in some other way if selected

            function draw_beam_search_vertices(plot_data, callback_on_click) {
                svg.selectAll("*").remove();
                x_scale = d3.scale.linear().domain([-0.25, search_length + 0.35]).range([0, d3_div.clientWidth]);
                y_scale = d3.scale.linear().domain([-1.0, 1.5 * (beam_size - 1) + 0.5]).range([0, d3_div.clientHeight]);

                svg.selectAll(".line").data(plot_data).enter().append("path").attr(line_attrs);

                circle_containers = svg.selectAll("g circleWithText").data(plot_data).enter().append("g")
                    .attr("transform", function (d) {
                        return `translate(${x_scale(d.x)}, ${y_scale(d.y)})`
                    })
                    .attr("data-entry-index", function (d, i) {
                        return i
                    })


                circle_containers.append("circle").attr(circle_attrs);
                circle_containers.append("text").text(function (d) {
                    return d.token_text;
                })
                    .attr('dy', -16).style("text-anchor", "middle").style("font-size", "16px")
                circle_containers.append("text").text(function (d) {
                    return d.circle_text;
                })
                    .attr('dy', "0.3em").style("text-anchor", "middle")
                    .style("font-size", "14px").style("font-weight", "bold")

                circle_containers
                    .on("mouseover", function (d, i) {
                        d3.select(this).style("font-weight", "bold");
                    })
                    .on("mouseout", function (d, i) {
                        d3.select(this).style("font-weight", "normal");
                    })
                    .on("click", function (d, i) {
                        callback_on_click(parseInt(this.dataset.entryIndex))
                    });
                // note: this.dataset.elemIndex will point to element's "data-entry-index" property that we set above
            }

        </script>

        <script> // this script defines the visual interface components

            var prompt_screen = document.getElementById('lm_prompt_screen');
            var prompt_input = prompt_screen.getElementsByClassName('input_prompt')[0];
            var prompt_next_button = prompt_screen.getElementsByClassName('next')[0];
            var prompt_status = prompt_screen.getElementsByClassName('status_comment')[0];
            var generate_screen = document.getElementById('lm_generate_screen');
            var generated_text = generate_screen.getElementsByClassName("input_preprocessed")[0];

            // generator state: tokens and RNN states for all tokens that are in the textarea
            var current_tokens = [], current_lstm_states = []; // should be of same length
            var beam_search_vertices;  // current beam search tree from which user can choose


            // load model, then enable the "next" button
            document.addEventListener('DOMContentLoaded', async function () {
                await async_initialize_model();
                prompt_next_button.style.opacity = 1.0;
                prompt_next_button.onclick = on_prompt_next
                prompt_status.innerHTML = `Just kidding, you can leave it blank. The machine doesn't need you :)`
            });

            async function on_prompt_next() {
                prompt_status.innerHTML = "Processing...";
                bootstrap_from_prefix(prompt_input.value);
                generate_screen.getElementsByClassName("button_add_greedy")[0].onclick = add_token_greedy;
                generate_screen.getElementsByClassName("button_backspace")[0].onclick = remove_last_token;
                generate_screen.getElementsByClassName("button_restart")[0].onclick = reset_to_prompt_screen;
                prompt_screen.style.display = 'none';
                generate_screen.style.display = 'block';
            }

            async function reset_to_prompt_screen() {
                prompt_status.innerHTML = "Another prompt, perhaps?";
                current_tokens = current_lstm_states = [];
                beam_search_vertices = undefined;
                prompt_screen.style.display = 'block';
                generate_screen.style.display = 'none';
            }

            async function bootstrap_from_prefix(prefix) {
                // tokenize, bpeize and lstm-ize prefix string,
                // populate current_tokens, token_indices and current_lstm_states
                current_tokens = Array.prototype.concat([bos], preprocess(prefix));
                generated_text.value = current_tokens.slice(1, current_tokens.length).join(" ")
                await sleep(50);
                generated_text.style.height = Math.max(Math.round(generated_text.scrollHeight), 64) + 'px';


                var token_indices = current_tokens.map(tok => (tok in token_to_ix ? token_to_ix[tok] : token_to_ix[unk]));
                var [prev_logits, prev_hid, prev_cell] = get_initial_state();

                for (let t = 0; t < token_indices.length; t++) {
                    token_ix = tf.tensor([token_indices[t]], null, "int32").reshape([1, -1]);
                    [prev_logits, prev_hid, prev_cell] = model.predict([token_ix, prev_hid, prev_cell]);
                    current_lstm_states.push([prev_logits, prev_hid, prev_cell]);
                }
                await redraw_user_interface();
            }

            async function redraw_user_interface() {
                generated_text.value = current_tokens.slice(1, current_tokens.length).join(" ")
                generated_text.scrollTop = generated_text.scrollHeight;
                var [prev_logits, prev_hid, prev_cell] = current_lstm_states[current_lstm_states.length - 1];
                beam_search_vertices = await generate_beam_search_vertices([prev_logits, prev_hid, prev_cell]);
                draw_beam_search_vertices(beam_search_vertices, callback_on_click = add_tokens_from_chosen_vertex);
            }

            async function add_token_greedy() {
                var [prev_logits, prev_hid, prev_cell] = current_lstm_states[current_lstm_states.length - 1];
                var token_ix = prev_logits.argMax(-1);
                current_lstm_states.push(model.predict([token_ix.reshape([1, -1]), prev_hid, prev_cell]));
                current_tokens.push(vocab[(await token_ix.array())[0]]);
                await redraw_user_interface();
            }

            async function remove_last_token() {
                if (current_tokens.length <= 1) return;
                current_tokens.pop();
                current_lstm_states.pop();
                await redraw_user_interface();
            }

            async function add_tokens_from_chosen_vertex(chosen_index) {
                var current_vertex = beam_search_vertices[chosen_index];
                var additional_tokens = [];
                while (current_vertex.parent_index != -1) {
                    additional_tokens.push(current_vertex.token_text);
                    current_vertex = beam_search_vertices[current_vertex.parent_index];
                }

                additional_tokens = additional_tokens.reverse();
                var token_indices = additional_tokens.map(tok => (tok in token_to_ix ? token_to_ix[tok] : token_to_ix[unk]));
                var [prev_logits, prev_hid, prev_cell] = current_lstm_states[current_lstm_states.length - 1];

                for (let t = 0; t < token_indices.length; t++) {
                    current_tokens.push(additional_tokens[t]);
                    token_ix = tf.tensor([token_indices[t]], null, "int32").reshape([1, -1]);
                    [prev_logits, prev_hid, prev_cell] = model.predict([token_ix, prev_hid, prev_cell]);
                    current_lstm_states.push([prev_logits, prev_hid, prev_cell]);
                }
                await redraw_user_interface();
            }

        </script>


    </div>


    </div>

    </div>

    </div>

    <footer class="site-footer">
        <div class="wrapper">

            <div class="footer-col-wrapper">
                <div class="footer-col">
                    <p class="text" align="right">&copy; Copyright <font color="#4869df"><strong><a
                                    href="https://lena-voita.github.io/" target="_blank">Lena Voita</a></strong></font>.
                        Translated by <font color="#4869df"><strong>MLNLP</strong></font>. All Rights Reserved
                    </p>
                </div>
            </div>

        </div>
    </footer>


</body>

</html>